{
  "code": "import PopUpView from \"../PopUpView\";\r\nimport WXFUI_BeforeWar from \"../../fui/Game/WXFUI_BeforeWar\";\r\nimport { GameManager } from \"../../Manager/GameManager\";\r\nimport { SoundManager } from \"../../Manager/SoundManager\";\r\nimport { ViewManager } from \"../../Manager/ViewManager\";\r\nimport { EventManager } from \"../../Manager/EventManager\";\r\nimport GameEvent from \"../../Control/GameEvent\";\r\nimport { MooSnowSDK } from \"../../Manager/MooSnowSDK\";\r\nimport { VideoType, VideoInfo } from \"../../Data/VideoData\";\r\nexport default class BeforeWar extends PopUpView {\r\n    constructor() { super(); }\r\n    createView() {\r\n        this.view = WXFUI_BeforeWar.createInstance();\r\n        this.view.m_enter.onClick(this, this.enterGame);\r\n        this.shopData = GameManager.instance.levelData.shop;\r\n        this.view.m_item_1.visible = this.view.m_item_2.visible = this.view.m_item_3.visible = this.view.m_item_4.visible = false;\r\n        var index = 0;\r\n        for (const key in this.shopData) {\r\n            if (this.shopData.hasOwnProperty(key)) {\r\n                index++;\r\n                var d = this.shopData[key];\r\n                this.view[\"m_item_\" + index].m_ani.setAutoPlay(true, -1);\r\n                this.view[\"m_item_\" + index].visible = true;\r\n                this.view[\"m_item_\" + index].m_coin.text = d.coin + \"\";\r\n                this.view[\"m_item_\" + index].m_info.text = d.name;\r\n                this.view[\"m_item_\" + index].m_icon.url = \"ui://Game/goods_\" + d.type;\r\n                this.view[\"m_item_\" + index].m_buy.onClick(this, this.buyItem, [d]);\r\n                this.view[\"m_item_\" + index].m_free.onClick(this, this.buyItemByFree, [d]);\r\n            }\r\n        }\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.QQ) {\r\n            this.view.m_ad2.m_list.visible = this.view.m_ad1.m_list.visible = false;\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            this.view.m_ad2.m_list.visible = this.view.m_ad1.m_list.visible = true;\r\n            this.view.m_ad2.m_list.itemRenderer = Laya.Handler.create(this, this.setADItem2, null, false);\r\n            this.view.m_ad1.m_list.itemRenderer = Laya.Handler.create(this, this.setADItem, null, false);\r\n            this.view.m_ad2.m_list.on(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n            this.view.m_ad1.m_list.on(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n            EventManager.instance.addNotice(GameEvent.SHOW_AD_LIST, this, this.showADList);\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.BYTEDANCE) {\r\n            this.view.m_ad2.m_list.visible = this.view.m_ad1.m_list.visible = false;\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO || GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n            this.view.m_ad2.m_list.visible = this.view.m_ad1.m_list.visible = false;\r\n        }\r\n    }\r\n    showView(s, c) {\r\n        super.showView(s, c);\r\n        this.view.m_ad1.m_list.y = 0;\r\n        this.showADList();\r\n        this.updateView();\r\n    }\r\n    buyItem(d) {\r\n        SoundManager.instance.playSound(\"btn_press\");\r\n        if (GameManager.instance.roleInfo.totalCoin < d.coin) {\r\n            ViewManager.instance.showTipsView(\"金币不足！\");\r\n            return;\r\n        }\r\n        else {\r\n            ViewManager.instance.showTipsView(\"金币-\" + d.coin);\r\n            GameManager.instance.roleInfo.totalCoin -= d.coin;\r\n            GameManager.instance.buyShopItem(d);\r\n            this.updateView();\r\n        }\r\n    }\r\n    updateView() {\r\n        this.view.m_coin.text = GameManager.instance.roleInfo.totalCoin + \"\";\r\n        this.view.m_bulletNum.text = GameManager.instance.buyBullet + \"\";\r\n        this.view.m_bombNum.text = GameManager.instance.buyGre + \"\";\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            MooSnowSDK.showBanner(false);\r\n        }\r\n    }\r\n    buyItemByFree(d) {\r\n        SoundManager.instance.playSound(\"btn_press\");\r\n        var v = GameManager.instance.createVideoData(VideoType.VIDEOTYPE_ITEM, VideoInfo.VIDEOINFO_ITEM);\r\n        MooSnowSDK.showVideo(d, v);\r\n    }\r\n    enterGame() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        ViewManager.instance.hidePopUpView(this, true);\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.QQ) {\r\n            if (MooSnowSDK.misTouchNum == 0) {\r\n                GameManager.instance.enterGame();\r\n            }\r\n            else if (MooSnowSDK.misTouchNum > 0) {\r\n                GameManager.instance.misTouchNum++;\r\n                if (GameManager.instance.misTouchNum >= MooSnowSDK.misTouchNum) {\r\n                    GameManager.instance.misTouchNum = 0;\r\n                    ViewManager.instance.showQQWuChuView(1);\r\n                }\r\n                else {\r\n                    GameManager.instance.enterGame();\r\n                }\r\n            }\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            GameManager.instance.enterGame();\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.BYTEDANCE) {\r\n            GameManager.instance.enterGame();\r\n        }\r\n        else {\r\n            GameManager.instance.enterGame();\r\n        }\r\n    }\r\n    showADList() {\r\n        if (GameManager.instance.adList.length < 1)\r\n            return;\r\n        if (GameManager.instance.platform != moosnow.APP_PLATFORM.WX)\r\n            return;\r\n        EventManager.instance.offNotice(GameEvent.SHOW_AD_LIST, this, this.showADList);\r\n        this.view.m_ad1.m_list.numItems = GameManager.instance.adList.length;\r\n        this.view.m_ad2.m_list.numItems = GameManager.instance.adListRever.length;\r\n        this.view.m_ad1.m_list.height = this.view.m_ad2.m_list.height = 311 * GameManager.instance.adList.length + 2;\r\n        Laya.Tween.clearTween(this.view.m_ad1.m_list);\r\n        this.adMoveUp();\r\n    }\r\n    setADItem(index, item) {\r\n        var d = GameManager.instance.adList[index];\r\n        if (!d)\r\n            return;\r\n        item.data = d;\r\n        item.m_icon.url = d.img;\r\n        item.m_name.text = d.title;\r\n    }\r\n    setADItem2(index, item) {\r\n        var d = GameManager.instance.adListRever[index];\r\n        if (!d)\r\n            return;\r\n        item.data = d;\r\n        item.m_icon.url = d.img;\r\n        item.m_name.text = d.title;\r\n    }\r\n    onClickItem(e) {\r\n        var m = e.data;\r\n        console.log(\"ad--\", m);\r\n        moosnow.platform.navigate2Mini(m, (res) => {\r\n            console.log('跳转成功 ', res);\r\n        }, (res) => {\r\n            console.log('跳转失败 ', res);\r\n            ViewManager.instance.showADListView(2);\r\n        });\r\n    }\r\n    adMoveDown() {\r\n        this._tweenNum = Laya.Tween.to(this.view.m_ad1.m_list, { y: 0 }, GameManager.instance.adTime, null, Laya.Handler.create(this, this.adMoveUp));\r\n        this._tweenNum.update = Laya.Handler.create(this, this.updateTween, null, false);\r\n    }\r\n    adMoveUp() {\r\n        this._tweenNum = Laya.Tween.to(this.view.m_ad1.m_list, { y: this.view.m_ad1.height - 311 * GameManager.instance.adList.length }, GameManager.instance.adTime, null, Laya.Handler.create(this, this.adMoveDown));\r\n        this._tweenNum.update = Laya.Handler.create(this, this.updateTween, null, false);\r\n    }\r\n    updateTween() {\r\n        this.view.m_ad2.m_list.y = this.view.m_ad1.m_list.y;\r\n    }\r\n    hideAllView() {\r\n        super.hideAllView();\r\n        Laya.Tween.clearTween(this.view.m_ad1.m_list);\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            MooSnowSDK.hideBanner();\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/View/PopUpView.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_BeforeWar.ts",
    "D:/littleGame/gunfire/src/Manager/GameManager.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_ADItem.ts",
    "D:/littleGame/gunfire/src/Manager/MooSnowSDK.ts",
    "D:/littleGame/gunfire/src/Data/VideoData.ts"
  ]
}
