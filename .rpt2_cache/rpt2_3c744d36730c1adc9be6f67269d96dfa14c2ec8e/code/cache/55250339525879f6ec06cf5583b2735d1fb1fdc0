{
  "code": "import PopUpView from \"../PopUpView\";\r\nimport WXFUI_ChapterView from \"../../fui/Game/WXFUI_ChapterView\";\r\nimport { GameManager } from \"../../Manager/GameManager\";\r\nimport GameEvent from \"../../Control/GameEvent\";\r\nimport { EventManager } from \"../../Manager/EventManager\";\r\nimport { SoundManager } from \"../../Manager/SoundManager\";\r\nimport { ViewManager } from \"../../Manager/ViewManager\";\r\nimport { MooSnowSDK } from \"../../Manager/MooSnowSDK\";\r\nexport default class ChapterView extends PopUpView {\r\n    constructor() {\r\n        super();\r\n        this.showSet = true;\r\n        this.showVolume = true;\r\n    }\r\n    createView() {\r\n        this.view = WXFUI_ChapterView.createInstance();\r\n        this.view.m_title.url = \"ui://Game/chapter_1\";\r\n        for (let t = 1; t <= GameManager.instance.maxLevel; t++) {\r\n            this.view[\"m_level_\" + t].on(Laya.Event.CLICK, this, this.chooseLevel, [t]);\r\n        }\r\n        this.view.m_setView.onClick(this, this.setVolume);\r\n        this.view.m_last.onClick(this, this.lastHandle);\r\n        this.view.m_next.onClick(this, this.nextHandle);\r\n        this.updateView();\r\n        EventManager.instance.addNotice(GameEvent.PAUSE_GAME, this, this.pauseGame);\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.QQ) {\r\n            this.view.m_ctl.selectedIndex = 1;\r\n            this.view.m_ad_remen2.onClick(this, this.showReMenAD2);\r\n            this.view.m_ad_remen2.m_ani_2.play(null, -1);\r\n            MooSnowSDK.showBanner(false);\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            this.view.m_ctl.selectedIndex = 0;\r\n            this.view.m_ad_1.onClick(this, this.onClickADItem, [1]);\r\n            this.view.m_ad_2.onClick(this, this.onClickADItem, [2]);\r\n            this.view.m_ad_3.onClick(this, this.onClickADItem, [3]);\r\n            this.view.m_ad_remen.onClick(this, this.showReMenAD);\r\n            this.view.m_ad.m_list.itemRenderer = Laya.Handler.create(this, this.setADItem, null, false);\r\n            this.view.m_ad.m_list.width = 240 * GameManager.instance.adList.length;\r\n            this.view.m_ad.m_list.on(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n            EventManager.instance.addNotice(GameEvent.SHOW_AD_LIST, this, this.showADList);\r\n            this.view.m_ad.m_n4.width = 1310;\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.BYTEDANCE) {\r\n            this.view.m_ctl.selectedIndex = 1;\r\n            this.view.m_ad_remen2.visible = false;\r\n            MooSnowSDK.hideBanner();\r\n        }\r\n        else if (GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO || GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n            this.view.m_ctl.selectedIndex = 1;\r\n            this.view.m_ad_remen2.visible = false;\r\n            MooSnowSDK.showBanner(false);\r\n        }\r\n    }\r\n    showView(s, c) {\r\n        super.showView(s, c);\r\n        this.view.m_ad.m_list.x = 0;\r\n        this.showADList();\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.QQ) {\r\n            MooSnowSDK.showBanner(false);\r\n        }\r\n    }\r\n    updateView() {\r\n        var c = GameManager.instance.curChapter;\r\n        this.view.m_title.url = \"ui://Game/chapter_\" + c;\r\n        for (let i = 1; i <= GameManager.instance.maxLevel; i++) {\r\n            var index = i + (c - 1) * GameManager.instance.maxLevel;\r\n            this.view[\"m_level_\" + i].m_star.m_ctl.selectedIndex = 0;\r\n            this.view[\"m_level_\" + i].m_numF.text = (i + (GameManager.instance.curChapter - 1) * GameManager.instance.maxLevel) + \"\";\r\n            if (index < GameManager.instance.gotoMaxLevel) {\r\n                this.view[\"m_level_\" + i].m_ctl.selectedIndex = 1;\r\n                this.view[\"m_level_\" + i].m_star.m_ctl.selectedIndex = 3;\r\n            }\r\n            else if (index == GameManager.instance.gotoMaxLevel) {\r\n                this.view[\"m_level_\" + i].m_ctl.selectedIndex = 2;\r\n                this.view[\"m_level_\" + i].m_star.m_ctl.selectedIndex = 1;\r\n            }\r\n            else {\r\n                this.view[\"m_level_\" + i].m_ctl.selectedIndex = 0;\r\n                this.view[\"m_level_\" + i].m_star.m_ctl.selectedIndex = 0;\r\n            }\r\n        }\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.QQ) {\r\n            this.view.m_ad_remen2.m_ani_2.play(null, -1);\r\n        }\r\n    }\r\n    chooseLevel(l) {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        console.log(\"选择第\" + GameManager.instance.curChapter + \"章，\" + \"第\" + l + \"关\");\r\n        if (l + (GameManager.instance.curChapter - 1) * GameManager.instance.maxLevel > GameManager.instance.gotoMaxLevel)\r\n            return;\r\n        GameManager.instance.choiseLevel = l + (GameManager.instance.curChapter - 1) * GameManager.instance.maxLevel;\r\n        console.log(\"选择第\" + GameManager.instance.choiseLevel + \"关\");\r\n        ViewManager.instance.showBeforeWarView();\r\n    }\r\n    setVolume() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        this.showVolume = !this.showVolume;\r\n        if (this.showVolume) {\r\n            this.view.m_setView.m_ctl.selectedIndex = 0;\r\n            SoundManager.instance.openSound();\r\n        }\r\n        else {\r\n            this.view.m_setView.m_ctl.selectedIndex = 1;\r\n            SoundManager.instance.offSound();\r\n        }\r\n    }\r\n    lastHandle() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        GameManager.instance.curChapter--;\r\n        if (GameManager.instance.curChapter < 1) {\r\n            GameManager.instance.curChapter = GameManager.instance.maxChapter;\r\n        }\r\n        this.updateView();\r\n    }\r\n    nextHandle() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        GameManager.instance.curChapter++;\r\n        if (GameManager.instance.curChapter > GameManager.instance.maxChapter) {\r\n            GameManager.instance.curChapter = 1;\r\n        }\r\n        this.updateView();\r\n    }\r\n    showReMenAD() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        ViewManager.instance.showADListView();\r\n    }\r\n    showReMenAD2() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        console.log(\"showReMenAD2\");\r\n        MooSnowSDK.showQQADBox();\r\n    }\r\n    showADList() {\r\n        if (GameManager.instance.adList.length < 1)\r\n            return;\r\n        if (GameManager.instance.platform != moosnow.APP_PLATFORM.WX)\r\n            return;\r\n        EventManager.instance.offNotice(GameEvent.SHOW_AD_LIST, this, this.showADList);\r\n        this.view.m_ad.m_list.width = 240 * GameManager.instance.adList.length;\r\n        this.view.m_ad.m_list.numItems = GameManager.instance.adList.length;\r\n        Laya.Tween.clearTween(this.view.m_ad.m_list);\r\n        Laya.timer.clear(this, this.changeAD);\r\n        this.adMoveLeft();\r\n        this.view.m_ad_1.m_ani_1.play(null, -1);\r\n        this.view.m_ad_2.m_ani_1.play(null, -1);\r\n        this.view.m_ad_3.m_ani_1.play(null, -1);\r\n        this.view.m_ad_remen.m_ani.play(null, -1);\r\n        this.changeAD();\r\n        Laya.timer.loop(3000, this, this.changeAD);\r\n    }\r\n    changeAD() {\r\n        this.view.m_ad_1.data = this.getRandomAdData();\r\n        this.view.m_ad_2.data = this.getRandomAdData();\r\n        this.view.m_ad_3.data = this.getRandomAdData();\r\n        this.view.m_ad_3.m_ad.m_icon.url = this.view.m_ad_3.data[\"img\"];\r\n        this.view.m_ad_3.m_ad.m_name.text = this.view.m_ad_3.data[\"title\"];\r\n        this.view.m_ad_2.m_ad.m_icon.url = this.view.m_ad_2.data[\"img\"];\r\n        this.view.m_ad_2.m_ad.m_name.text = this.view.m_ad_2.data[\"title\"];\r\n        this.view.m_ad_1.m_ad.m_icon.url = this.view.m_ad_1.data[\"img\"];\r\n        this.view.m_ad_1.m_ad.m_name.text = this.view.m_ad_1.data[\"title\"];\r\n    }\r\n    setADItem(index, item) {\r\n        var d = GameManager.instance.adList[index];\r\n        if (!d)\r\n            return;\r\n        item.data = d;\r\n        item.m_icon.url = d.img;\r\n        item.m_name.text = d.title;\r\n    }\r\n    onClickADItem(index) {\r\n        var m = this.view[\"m_ad_\" + index].data;\r\n        if (!m)\r\n            return;\r\n        console.log(\"onClickADItem--\", m);\r\n        moosnow.platform.navigate2Mini(m, (res) => {\r\n            console.log('跳转成功 ', res);\r\n        }, (res) => {\r\n            console.log('跳转失败 ', res);\r\n            ViewManager.instance.showADListView();\r\n        });\r\n    }\r\n    onClickItem(e) {\r\n        var m = e.data;\r\n        console.log(\"ad--\", m);\r\n        if (!m)\r\n            return;\r\n        moosnow.platform.navigate2Mini(m, (res) => {\r\n            console.log('跳转成功 ', res);\r\n        }, (res) => {\r\n            console.log('跳转失败 ', res);\r\n            ViewManager.instance.showADListView();\r\n        });\r\n    }\r\n    adMoveLeft() {\r\n        Laya.Tween.to(this.view.m_ad.m_list, { x: this.view.m_ad.width - 240 * GameManager.instance.adList.length }, GameManager.instance.adTime, null, Laya.Handler.create(this, this.adMoveRight));\r\n    }\r\n    adMoveRight() {\r\n        Laya.Tween.to(this.view.m_ad.m_list, { x: 0 }, GameManager.instance.adTime, null, Laya.Handler.create(this, this.adMoveLeft));\r\n    }\r\n    pauseGame() {\r\n        if (GameManager.instance.isPauseGame) {\r\n            this.hideADList();\r\n        }\r\n        else {\r\n            this.showADList();\r\n        }\r\n    }\r\n    hideADList() {\r\n        this.view.m_ad_1.m_ani_1.stop(null);\r\n        this.view.m_ad_2.m_ani_1.stop(null);\r\n        this.view.m_ad_3.m_ani_1.stop(null);\r\n        this.view.m_ad_remen.m_ani.stop(null);\r\n        Laya.Tween.clearTween(this.view.m_ad.m_list);\r\n        Laya.timer.clear(this, this.changeAD);\r\n    }\r\n    hideAllView() {\r\n        super.hideAllView();\r\n        this.hideADList();\r\n    }\r\n    getRandomAdData() {\r\n        var r = Math.floor(Math.random() * GameManager.instance.adList.length);\r\n        return GameManager.instance.adList[r];\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/View/PopUpView.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_ChapterView.ts",
    "D:/littleGame/gunfire/src/Manager/GameManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_ADItem.ts",
    "D:/littleGame/gunfire/src/Manager/MooSnowSDK.ts"
  ]
}
