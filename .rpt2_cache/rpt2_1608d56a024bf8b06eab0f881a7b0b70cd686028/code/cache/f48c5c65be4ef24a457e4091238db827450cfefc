{
  "code": "import { GameManager } from \"../Manager/GameManager\";\r\nimport { EventManager } from \"../Manager/EventManager\";\r\nimport GameEvent from \"../Control/GameEvent\";\r\nimport { GoodsType, GameData } from \"../Data/GameData\";\r\nimport { PlayerData } from \"../Data/PlayerData\";\r\nimport { SoundManager } from \"../Manager/SoundManager\";\r\nimport { ViewManager } from \"../Manager/ViewManager\";\r\nexport default class PlayerInfoView {\r\n    constructor() { this.createView(); }\r\n    createView() {\r\n        this.view = fairygui.UIPackage.createObject(\"Game\", \"PlayerInfoView\");\r\n        EventManager.instance.addNotice(GameEvent.CHANGE_PLAYER_GOODS, this, this.changePlayerGoods);\r\n        EventManager.instance.addNotice(GameEvent.USE_PLAYER_BULLET, this, this.usePlyerBullet);\r\n        EventManager.instance.addNotice(GameEvent.USE_PLAYER_BOMB, this, this.decBombNum);\r\n        EventManager.instance.addNotice(GameEvent.ENEMY_BOMB_HIT_PLAYER, this, this.decPlayerBlood);\r\n        EventManager.instance.addNotice(GameEvent.ENEMY_BULLET_HIT_PLAYER, this, this.decPlayerBlood);\r\n        this.updateAllView();\r\n        this.view.m_pause.onClick(this, this.pauseGame);\r\n    }\r\n    updateAllView() {\r\n        this.updateBulletNum();\r\n        this.updatePlayerBlood();\r\n        this.updateGreNum();\r\n        this.updateCoin();\r\n    }\r\n    pauseGame() {\r\n        SoundManager.instance.playSound(\"btn_press\");\r\n        ViewManager.instance.showSuspendView();\r\n        Laya.timer.once(300, this, () => {\r\n            GameManager.instance.suspendGame();\r\n        });\r\n    }\r\n    changePlayerGoods(t) {\r\n        if (t == GoodsType.GoodsType_MED) {\r\n            GameManager.instance.roleInfo.blood++;\r\n            this.updatePlayerBlood();\r\n        }\r\n        else if (t == GoodsType.GoodsType_MAC) {\r\n            if (GameManager.instance.roleInfo.weaponType == PlayerData.WEAPON_MAC) {\r\n                GameManager.instance.roleInfo.bulletNum += GameManager.instance.roleInfo.addMacNum;\r\n            }\r\n            else {\r\n                GameManager.instance.roleInfo.bulletNum = GameManager.instance.roleInfo.addMacNum;\r\n                GameManager.instance.roleInfo.weaponType = PlayerData.WEAPON_MAC;\r\n            }\r\n            EventManager.instance.dispatcherEvt(GameEvent.CHANGE_PLAYER_WEAPON, GameManager.instance.roleInfo.weaponType);\r\n            this.updateBulletNum();\r\n        }\r\n        else if (t == GoodsType.GoodsType_RIF) {\r\n            if (GameManager.instance.roleInfo.weaponType == PlayerData.WEAPON_RIFLE) {\r\n                GameManager.instance.roleInfo.bulletNum += GameManager.instance.roleInfo.addRifNum;\r\n            }\r\n            else {\r\n                GameManager.instance.roleInfo.bulletNum = GameManager.instance.roleInfo.addRifNum;\r\n                GameManager.instance.roleInfo.weaponType = PlayerData.WEAPON_RIFLE;\r\n            }\r\n            this.updateBulletNum();\r\n            EventManager.instance.dispatcherEvt(GameEvent.CHANGE_PLAYER_WEAPON, GameManager.instance.roleInfo.weaponType);\r\n        }\r\n        else if (t == GoodsType.GoodsType_GRE) {\r\n            GameManager.instance.roleInfo.bombNum += GameManager.instance.roleInfo.addBombNum;\r\n            this.updateGreNum();\r\n        }\r\n        else if (t == GoodsType.GoodsType_COIN) {\r\n            var coin = this.getRandomCoin();\r\n            GameManager.instance.roleInfo.curlvCoin += coin;\r\n            GameManager.instance.roleInfo.totalCoin += coin;\r\n            this.updateCoin();\r\n        }\r\n    }\r\n    decPlayerBlood() {\r\n        GameManager.instance.roleInfo.blood--;\r\n        if (GameManager.instance.roleInfo.blood < 0)\r\n            GameManager.instance.roleInfo.blood = 0;\r\n        this.updatePlayerBlood();\r\n    }\r\n    usePlyerBullet() {\r\n        if (GameManager.instance.roleInfo.weaponType == PlayerData.WEAPON_PIS)\r\n            return;\r\n        GameManager.instance.roleInfo.bulletNum--;\r\n        if (GameManager.instance.roleInfo.bulletNum <= 0) {\r\n            GameManager.instance.roleInfo.weaponType = PlayerData.WEAPON_PIS;\r\n            EventManager.instance.dispatcherEvt(GameEvent.CHANGE_PLAYER_WEAPON, PlayerData.WEAPON_PIS);\r\n        }\r\n        this.updateBulletNum();\r\n    }\r\n    decBombNum() {\r\n        GameManager.instance.roleInfo.bombNum--;\r\n        this.updateGreNum();\r\n    }\r\n    updateBulletNum() {\r\n        this.view.m_bullet.text = GameManager.instance.roleInfo.bulletNum + \"\";\r\n    }\r\n    updateGreNum() {\r\n        this.view.m_gre.text = GameManager.instance.roleInfo.bombNum + \"\";\r\n    }\r\n    updateCoin() {\r\n        this.view.m_coin.text = GameManager.instance.roleInfo.totalCoin + \"\";\r\n    }\r\n    updatePlayerBlood() {\r\n        if (GameManager.instance.roleInfo.blood <= 0) {\r\n            EventManager.instance.dispatcherEvt(GameEvent.PLAYER_DEATH);\r\n        }\r\n        for (let i = 3; i > 0; i--) {\r\n            if (i <= GameManager.instance.roleInfo.blood) {\r\n                this.view[\"m_blood_\" + i].visible = true;\r\n            }\r\n            else {\r\n                this.view[\"m_blood_\" + i].visible = false;\r\n            }\r\n        }\r\n    }\r\n    getRandomCoin() {\r\n        return Math.floor((Math.random() * 100) * GameData.RANDOM_COIN / 100);\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_PlayerInfoView.ts",
    "D:/littleGame/gunfire/src/Manager/GameManager.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Data/GameData.ts",
    "D:/littleGame/gunfire/src/Data/PlayerData.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts"
  ]
}
