"use strict";var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault"),_Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:!0}),exports.default=rpkPlugin;var _promise=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/promise")),_path=_interopRequireDefault(require("path")),_jszip=_interopRequireDefault(require("jszip")),_cliSharedUtils=require("@vivo-minigame/cli-shared-utils"),_readdir=_interopRequireDefault(require("./readdir")),_constanst=require("./constanst");/**
 * 打插件包 不使用zip，md5值会变，所以单独提出来
 * @param {String} name rpk包的文件名
 * @param {Array(String)} pluginPath 插件目录名称
 * @param {String} pathTo 打包rpk到何处
 */function rpkPlugin(a,b,c){// 保证打包路径存在，不存在就创建
return _cliSharedUtils.fs.ensureDir(c).then(()=>((0,_cliSharedUtils.info)(`${_constanst.LOG_TITLE}开始打插件包:${a} from:${b}`),new _promise.default(d=>{const e=_path.default.join(c,a),f=_cliSharedUtils.fs.createWriteStream(e),g=new _jszip.default,h=(0,_readdir.default)(_path.default.join(_cliSharedUtils.projectPath,b,"/"));h.forEach(a=>{const c=_path.default.join(_cliSharedUtils.projectPath,b,"/",a);g.file(a,_cliSharedUtils.fs.createReadStream(c))}),g.generateNodeStream({compression:"DEFLATE",compressionOptions:{level:9}}).pipe(f),f.on("finish",()=>{(0,_cliSharedUtils.info)(`${_constanst.LOG_TITLE}压缩完成:${a}`),d()})}))).catch(a=>{(0,_cliSharedUtils.error)(a)})}