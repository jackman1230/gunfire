{
  "code": "import PopUpView from \"../PopUpView\";\r\nimport WXFUI_AfterWar from \"../../fui/Game/WXFUI_AfterWar\";\r\nimport { SoundManager } from \"../../Manager/SoundManager\";\r\nimport { GameManager } from \"../../Manager/GameManager\";\r\nimport { EventManager } from \"../../Manager/EventManager\";\r\nimport GameEvent from \"../../Control/GameEvent\";\r\nimport { MooSnowSDK } from \"../../Manager/MooSnowSDK\";\r\nimport { ViewManager } from \"../../Manager/ViewManager\";\r\nimport { VideoType, VideoInfo } from \"../../Data/VideoData\";\r\nexport default class AfterWar extends PopUpView {\r\n    constructor() {\r\n        super();\r\n        this.viewType = 1;\r\n        this.hotNum = 6;\r\n        this.adList = [];\r\n        this._checkBoxMistouch = false;\r\n        this._clickCount = 0;\r\n        this._randomList = [];\r\n    }\r\n    createView() {\r\n        this.view = WXFUI_AfterWar.createInstance();\r\n        this.view.m_coin.text = \" 0\";\r\n        this.view.m_ad_1.m_list.itemRenderer = Laya.Handler.create(this, this.setADItem1, null, false);\r\n        this.view.m_ad_2.m_list.itemRenderer = Laya.Handler.create(this, this.setADItem2, null, false);\r\n        EventManager.instance.addNotice(GameEvent.SHOW_AD_LIST, this, this.showADList);\r\n        this.view.m_adHot.m_jixu.onClick(this, this.hideADHot);\r\n        this._sdkData = MooSnowSDK.getAllConfig();\r\n        if (this._sdkData && this._sdkData.checkBoxMistouch != \"0\") {\r\n            this._checkBoxMistouch = true;\r\n            this._randomList = MooSnowSDK.getAllConfig().checkBoxProbabilitys;\r\n        }\r\n    }\r\n    clickHotAdItem(n) {\r\n        var m = this.view.m_adHot[\"m_ad_\" + n].data;\r\n        if (!m)\r\n            return;\r\n        console.log(\"ad--\", m);\r\n        moosnow.platform.navigate2Mini(m, (res) => {\r\n            console.log('跳转成功 ', res);\r\n        }, (res) => {\r\n            console.log('跳转失败 ', res);\r\n            this.changeAdItem(n);\r\n        });\r\n    }\r\n    changeAdItem(n) {\r\n        var d = this.getRandomAdItem();\r\n        if (!d)\r\n            return;\r\n        this.view.m_adHot[\"m_ad_\" + n].data = d;\r\n        this.view.m_adHot[\"m_ad_\" + n].m_icon.url = d.img;\r\n        this.view.m_adHot[\"m_ad_\" + n].m_name.text = d.title;\r\n    }\r\n    hideADHot() {\r\n        MooSnowSDK.hideBanner();\r\n        ViewManager.instance.showADListView(1);\r\n    }\r\n    showView(s, c) {\r\n        super.showView(s, c);\r\n        this.view.m_continue_1.onClick(this, this.continueGame);\r\n        this.view.m_continue_2.onClick(this, this.restartGame);\r\n        this.view.m_continue_3.onClick(this, this.continueGameByVideo);\r\n        this.view.m_return.onClick(this, this.returnHandle);\r\n        this.view.m_abandon.onClick(this, this.abandonHandle);\r\n        this.view.m_nextBtn.onClick(this, this.onNextHandle);\r\n        this.view.m_gou.onClick(this, this.gouHandle);\r\n        this.view.m_ad_1.m_list.on(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n        this.view.m_ad_2.m_list.on(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n        this.view.m_ad_1.m_list.y = 0;\r\n        this.view.m_adHot.visible = false;\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            this.showADList();\r\n            MooSnowSDK.showBanner(false);\r\n            this.view.m_ad_1.visible = this.view.m_ad_2.visible = true;\r\n        }\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.QQ) {\r\n            MooSnowSDK.hideBanner();\r\n            this.view.m_ad_1.visible = this.view.m_ad_2.visible = false;\r\n            EventManager.instance.addNotice(GameEvent.CLOSE_APP_AD_BOX, this, this.closeAppBox);\r\n        }\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.BYTEDANCE) {\r\n            MooSnowSDK.hideBanner();\r\n            this.view.m_ad_1.visible = this.view.m_ad_2.visible = false;\r\n            this.view.m_gou.selected = true;\r\n        }\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO || GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n            MooSnowSDK.hideBanner();\r\n            this.view.m_ad_1.visible = this.view.m_ad_2.visible = false;\r\n        }\r\n    }\r\n    closeAppBox() {\r\n        MooSnowSDK.showBanner(false);\r\n    }\r\n    showHotAdList() {\r\n        for (let i = 1; i <= 6; i++) {\r\n            var d = this.getRandomAdItem();\r\n            if (!d)\r\n                continue;\r\n            this.view.m_adHot[\"m_ad_\" + i].data = d;\r\n            this.view.m_adHot[\"m_ad_\" + i].m_icon.url = d.img;\r\n            this.view.m_adHot[\"m_ad_\" + i].m_name.text = d.title;\r\n            this.view.m_adHot[\"m_ad_\" + i].onClick(this, this.clickHotAdItem, [i]);\r\n        }\r\n    }\r\n    updateView(type) {\r\n        this.viewType = type;\r\n        this.updateCoin();\r\n        this.view.m_nativeAD.visible = false;\r\n        this.view.m_oppoNative.visible = false;\r\n        this.view.m_sanbei.visible = false;\r\n        this.view.m_nextBtn2.visible = false;\r\n        if (type == 3) {\r\n            this.view.m_abandon.visible = false;\r\n            if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX)\r\n                ViewManager.instance.showADListView();\r\n            if (GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n                this.showAbondon();\r\n            }\r\n            else {\r\n                Laya.timer.once(2000, this, this.showAbondon);\r\n            }\r\n        }\r\n        else if (type == 1) {\r\n            if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n                this.view.m_adHot.visible = true;\r\n                this.adList = GameManager.instance.adList.concat();\r\n                this.showHotAdList();\r\n            }\r\n            if (GameManager.instance.platform == moosnow.APP_PLATFORM.BYTEDANCE) {\r\n                this.view.m_ctl.selectedIndex = 3;\r\n                this._clickCount = 0;\r\n                if (this._checkBoxMistouch)\r\n                    this.getRandomMisTouchIndex();\r\n            }\r\n        }\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO || GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n            if (type == 3) {\r\n                this.view.m_nativeAD.m_ctl.selectedIndex = 1;\r\n                this.view.m_oppoNative.m_ctl.selectedIndex = 1;\r\n                if (GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n                    this.view.m_pos.selectedIndex = 1;\r\n                }\r\n            }\r\n            else {\r\n                this.view.m_nativeAD.m_ctl.selectedIndex = 0;\r\n                this.view.m_oppoNative.m_ctl.selectedIndex = 0;\r\n                if (GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n                    this.view.m_continue_1.visible = false;\r\n                    this.view.m_sanbei.visible = true;\r\n                    this.view.m_sanbei.onClick(this, this.onSanBeiHandle);\r\n                    this.view.m_nextBtn2.visible = true;\r\n                    this.view.m_nextBtn2.onClick(this, this.continueGame);\r\n                }\r\n            }\r\n            var self = this;\r\n            moosnow.platform.checkVersion(\"\", (open) => {\r\n                if (open) {\r\n                    moosnow.platform.showNativeAd((row) => {\r\n                        if (row && row.imgUrlList && row.imgUrlList.length > 0) {\r\n                            if (GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO)\r\n                                self.showNativeAD(row);\r\n                            else {\r\n                                self.showOppoNativeAD(row);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n    showNativeAD(row) {\r\n        Laya.timer.once(500, this, () => {\r\n            this.view.m_nativeAD.visible = true;\r\n            this.view.m_nativeAD.m_close.onClick(this, this.onCloseHandle);\r\n            this.view.m_nativeAD.m_see.onClick(this, this.onSeeHandle);\r\n            this.view.m_nativeAD.m_pass.onClick(this, this.onSeeHandle);\r\n            if (this._sdkData && this._sdkData.mx_native_click_switch && this._sdkData.mx_native_click_switch == 1) {\r\n                this.view.m_nativeAD.m_see.visible = false;\r\n                this.view.m_nativeAD.m_pass.visible = true;\r\n            }\r\n            else {\r\n                this.view.m_nativeAD.m_see.visible = true;\r\n                this.view.m_nativeAD.m_pass.visible = false;\r\n            }\r\n            Laya.loader.create(row.imgUrlList[0], Laya.Handler.create(this, (res) => {\r\n                if (res == null)\r\n                    return;\r\n                this.view.m_nativeAD.m_load.url = row.imgUrlList[0];\r\n            }));\r\n        });\r\n    }\r\n    showOppoNativeAD(row) {\r\n        Laya.timer.once(500, this, () => {\r\n            this.view.m_oppoNative.visible = true;\r\n            this.view.m_oppoNative.m_close.onClick(this, this.onCloseHandle);\r\n            this.view.m_oppoNative.m_see.onClick(this, this.onSeeHandle);\r\n            this.view.m_oppoNative.m_pass.onClick(this, this.onSeeHandle);\r\n            if (this._sdkData && this._sdkData.mx_native_click_switch && this._sdkData.mx_native_click_switch == 1) {\r\n                this.view.m_oppoNative.m_see.visible = false;\r\n                this.view.m_oppoNative.m_pass.visible = true;\r\n            }\r\n            else {\r\n                this.view.m_oppoNative.m_see.visible = true;\r\n                this.view.m_oppoNative.m_pass.visible = false;\r\n            }\r\n            Laya.loader.create(row.imgUrlList[0], Laya.Handler.create(this, (res) => {\r\n                if (res == null)\r\n                    return;\r\n                this.view.m_oppoNative.m_load.url = row.imgUrlList[0];\r\n            }));\r\n        });\r\n    }\r\n    onCloseHandle() {\r\n        var r = Math.random() * 100;\r\n        if (r <= this._sdkData.nativeAdCloseOpenV)\r\n            MooSnowSDK.clickNative(this.hideNativeAD.bind(this));\r\n        else\r\n            this.hideNativeAD();\r\n    }\r\n    hideNativeAD() {\r\n        this.view.m_nativeAD.visible = false;\r\n        this.view.m_oppoNative.visible = false;\r\n    }\r\n    onSeeHandle() {\r\n        MooSnowSDK.clickNative(this.hideNativeAD.bind(this));\r\n    }\r\n    showAbondon() {\r\n        this.view.m_abandon.visible = true;\r\n    }\r\n    updateCoin() {\r\n        this.view.m_coin.text = \" \" + GameManager.instance.roleInfo.curlvCoin + \" \";\r\n    }\r\n    continueGame() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        GameManager.instance.goFirstPage(true);\r\n        MooSnowSDK.endGame(GameManager.instance.choiseLevel, true);\r\n    }\r\n    restartGame() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        GameManager.instance.restartGame();\r\n    }\r\n    continueGameByVideo() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        var v = GameManager.instance.createVideoData(VideoType.VIDEOTYPE_LIFE, VideoInfo.VIDEOINFO_LIFE);\r\n        MooSnowSDK.showVideo(null, v);\r\n    }\r\n    abandonHandle() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        GameManager.instance.goFirstPage(true);\r\n        MooSnowSDK.endGame(GameManager.instance.choiseLevel, false);\r\n    }\r\n    onNextHandle() {\r\n        if (this.view.m_gou.selected) {\r\n            this.watchVideo();\r\n        }\r\n        else {\r\n            this.continueGame();\r\n        }\r\n    }\r\n    onSanBeiHandle() {\r\n        var v = GameManager.instance.createVideoData(VideoType.VIDEOTYPE_TREBLE_COIN, VideoInfo.VIDEOTYPE_TREBLE_COIN);\r\n        MooSnowSDK.showVideo(null, v, this.getTrebleCoin.bind(this));\r\n    }\r\n    getTrebleCoin() {\r\n    }\r\n    gouHandle() {\r\n        if (this._checkBoxMistouch) {\r\n            if (this._clickCount == this._misTouchIndex) {\r\n                this.watchVideo();\r\n            }\r\n            this._clickCount++;\r\n        }\r\n    }\r\n    watchVideo() {\r\n        var v = GameManager.instance.createVideoData(VideoType.VIDEOTYPE_DOUBLE_COIN, VideoInfo.VIDEOINFO_DOUBLE_COIN);\r\n        MooSnowSDK.showVideo(null, v);\r\n    }\r\n    returnHandle() {\r\n        SoundManager.instance.playSound(\"btn_click\");\r\n        GameManager.instance.goFirstPage(true);\r\n    }\r\n    showADList() {\r\n        if (GameManager.instance.adList.length < 1)\r\n            return;\r\n        if (GameManager.instance.platform != moosnow.APP_PLATFORM.WX)\r\n            return;\r\n        EventManager.instance.offNotice(GameEvent.SHOW_AD_LIST, this, this.showADList);\r\n        Laya.Tween.clearTween(this.view.m_ad_1.m_list);\r\n        this.view.m_ad_1.m_list.numItems = GameManager.instance.adList.length;\r\n        this.view.m_ad_2.m_list.numItems = GameManager.instance.adListRever.length;\r\n        this.view.m_ad_1.m_list.height = this.view.m_ad_2.m_list.height = 311 * GameManager.instance.adList.length + 2;\r\n        this.adMoveUp();\r\n    }\r\n    onClickItem(e) {\r\n        var m = e.data;\r\n        console.log(\"ad--\", m);\r\n        moosnow.platform.navigate2Mini(m, (res) => {\r\n            console.log('跳转成功 ', res);\r\n        }, (res) => {\r\n            console.log('跳转失败 ', res);\r\n            ViewManager.instance.showADListView();\r\n        });\r\n    }\r\n    setADItem1(index, item) {\r\n        var d = GameManager.instance.adList[index];\r\n        if (!d)\r\n            return;\r\n        item.data = d;\r\n        item.m_icon.url = d.img;\r\n        item.m_name.text = d.title;\r\n    }\r\n    setADItem2(index, item) {\r\n        var d = GameManager.instance.adListRever[index];\r\n        if (!d)\r\n            return;\r\n        item.data = d;\r\n        item.m_icon.url = d.img;\r\n        item.m_name.text = d.title;\r\n    }\r\n    adMoveDown() {\r\n        this._tweenNum = Laya.Tween.to(this.view.m_ad_1.m_list, { y: 0 }, GameManager.instance.adTime, null, Laya.Handler.create(this, this.adMoveUp));\r\n        this._tweenNum.update = Laya.Handler.create(this, this.updateTween, null, false);\r\n    }\r\n    adMoveUp() {\r\n        this._tweenNum = Laya.Tween.to(this.view.m_ad_1.m_list, { y: this.view.m_ad_1.height - 311 * GameManager.instance.adList.length }, GameManager.instance.adTime, null, Laya.Handler.create(this, this.adMoveDown));\r\n        this._tweenNum.update = Laya.Handler.create(this, this.updateTween, null, false);\r\n    }\r\n    updateTween() {\r\n        this.view.m_ad_2.m_list.y = this.view.m_ad_1.m_list.y;\r\n    }\r\n    hideAllView() {\r\n        super.hideAllView();\r\n        this.view.m_continue_1.offClick(this, this.continueGame);\r\n        this.view.m_continue_2.offClick(this, this.restartGame);\r\n        this.view.m_continue_3.offClick(this, this.continueGameByVideo);\r\n        this.view.m_return.offClick(this, this.returnHandle);\r\n        this.view.m_abandon.offClick(this, this.abandonHandle);\r\n        this.view.m_nextBtn.offClick(this, this.onNextHandle);\r\n        this.view.m_gou.offClick(this, this.gouHandle);\r\n        this.view.m_nativeAD.m_close.offClick(this, this.onCloseHandle);\r\n        this.view.m_nativeAD.m_see.offClick(this, this.onSeeHandle);\r\n        this.view.m_nativeAD.m_pass.offClick(this, this.onSeeHandle);\r\n        this.view.m_oppoNative.m_close.offClick(this, this.onCloseHandle);\r\n        this.view.m_oppoNative.m_see.offClick(this, this.onSeeHandle);\r\n        this.view.m_oppoNative.m_pass.offClick(this, this.onSeeHandle);\r\n        this.view.m_sanbei.offClick(this, this.onSanBeiHandle);\r\n        this.view.m_nextBtn2.offClick(this, this.continueGame);\r\n        this.view.m_ad_1.m_list.off(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n        this.view.m_ad_2.m_list.off(fairygui.Events.CLICK_ITEM, this, this.onClickItem);\r\n        Laya.Tween.clearTween(this.view.m_ad_1.m_list);\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.WX) {\r\n            MooSnowSDK.hideBanner();\r\n        }\r\n        for (let i = 1; i <= 6; i++) {\r\n            this.view.m_adHot[\"m_ad_\" + i].offClick(this, this.clickHotAdItem, [i]);\r\n        }\r\n        EventManager.instance.offNotice(GameEvent.CLOSE_APP_AD_BOX, this, this.closeAppBox);\r\n    }\r\n    getRandomAdItem() {\r\n        if (this.adList.length > 0) {\r\n        }\r\n        else {\r\n            this.adList = GameManager.instance.adList.concat();\r\n        }\r\n        var n = Math.floor(Math.random() * this.adList.length);\r\n        var d = this.adList.splice(n, 1)[0];\r\n        console.log(\"d---\", d);\r\n        return d;\r\n    }\r\n    getRandomMisTouchIndex() {\r\n        var arr = [];\r\n        var idx = 0;\r\n        for (var i = 0; i < this._randomList.length; i++) {\r\n            var num = this._randomList[i];\r\n            for (var j = 0; j < num; j++)\r\n                arr.push(idx);\r\n            idx++;\r\n        }\r\n        if (arr.length > 0)\r\n            this._misTouchIndex = arr[Math.floor(Math.random() * arr.length)];\r\n        else\r\n            this._misTouchIndex = 1000000;\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/View/PopUpView.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_AfterWar.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/Manager/GameManager.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_ADItem.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Manager/MooSnowSDK.ts",
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/Data/VideoData.ts"
  ]
}
