{
  "code": "import { GameManager } from \"../Manager/GameManager\";\r\nimport { EventManager } from \"../Manager/EventManager\";\r\nimport GameEvent from \"../Control/GameEvent\";\r\nimport { GoodsType, GameData } from \"../Data/GameData\";\r\nimport { PlayerData } from \"../Data/PlayerData\";\r\nimport { SoundManager } from \"../Manager/SoundManager\";\r\nimport { ViewManager } from \"../Manager/ViewManager\";\r\nimport { MooSnowSDK } from \"../Manager/MooSnowSDK\";\r\nimport { VideoType, VideoInfo } from \"../Data/VideoData\";\r\nexport default class PlayerInfoView {\r\n    constructor() { this.createView(); }\r\n    createView() {\r\n        this.view = fairygui.UIPackage.createObject(\"Game\", \"PlayerInfoView\");\r\n        EventManager.instance.addNotice(GameEvent.CHANGE_PLAYER_GOODS, this, this.changePlayerGoods);\r\n        EventManager.instance.addNotice(GameEvent.USE_PLAYER_BULLET, this, this.usePlyerBullet);\r\n        EventManager.instance.addNotice(GameEvent.USE_PLAYER_BOMB, this, this.decBombNum);\r\n        EventManager.instance.addNotice(GameEvent.DEC_PLAYER_BLOOD, this, this.updatePlayerBlood);\r\n        this.view.m_item_1.visible = this.view.m_item_2.visible = this.view.m_item_3.visible = false;\r\n        if (GameManager.instance.platform == moosnow.APP_PLATFORM.BYTEDANCE) {\r\n            this.view.m_item_1.visible = this.view.m_item_2.visible = this.view.m_item_3.visible = true;\r\n            this.initBuyItem();\r\n        }\r\n        this.updateAllView();\r\n        this.view.m_pause.onClick(this, this.pauseGame);\r\n        this.layout();\r\n    }\r\n    layout() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            let wxInfo = wx.getSystemInfoSync();\r\n            var h = (wxInfo.windowHeight / 750) * 1334;\r\n            this.view.x = 80 * (Laya.stage.width / 1334);\r\n            if ((wxInfo.windowWidth / wxInfo.windowHeight) > 2) {\r\n                this.view.m_pause.x = 1050;\r\n            }\r\n            else\r\n                this.view.m_pause.x = 950;\r\n        }\r\n        else {\r\n            var h = (Laya.Browser.height / 750) * 1334;\r\n            this.view.x = 100 * (Laya.Browser.width / h);\r\n        }\r\n        this.view.y = 0;\r\n    }\r\n    updateAllView() {\r\n        this.updateBulletNum();\r\n        this.updatePlayerBlood();\r\n        this.updateGreNum();\r\n        this.updateCoin();\r\n        this.updateLevel();\r\n    }\r\n    updateLevel() {\r\n        this.view.m_level.text = \" 第\" + GameManager.instance.curLevel + \"关 \";\r\n    }\r\n    pauseGame() {\r\n        SoundManager.instance.playSound(\"btn_press\");\r\n        ViewManager.instance.showSuspendView();\r\n        GameManager.instance.suspendGame();\r\n    }\r\n    changePlayerGoods(t) {\r\n        if (t == GoodsType.GoodsType_MED) {\r\n            GameManager.instance.roleInfo.blood += 2;\r\n            if (GameManager.instance.roleInfo.blood > GameManager.instance.oriBlood)\r\n                GameManager.instance.roleInfo.blood = GameManager.instance.oriBlood;\r\n            this.updatePlayerBlood();\r\n            ViewManager.instance.createAddGold(t, 1, true);\r\n        }\r\n        else if (t == GoodsType.GoodsType_MAC) {\r\n            if (GameManager.instance.roleInfo.weaponType == PlayerData.WEAPON_MAC) {\r\n                GameManager.instance.roleInfo.bulletNum += GameManager.instance.roleInfo.addMacNum;\r\n            }\r\n            else {\r\n                GameManager.instance.roleInfo.bulletNum = GameManager.instance.roleInfo.addMacNum;\r\n                GameManager.instance.roleInfo.weaponType = PlayerData.WEAPON_MAC;\r\n            }\r\n            EventManager.instance.dispatcherEvt(GameEvent.CHANGE_PLAYER_WEAPON, GameManager.instance.roleInfo.weaponType);\r\n            this.updateBulletNum();\r\n            ViewManager.instance.createAddGold(t, GameManager.instance.roleInfo.addMacNum, true);\r\n        }\r\n        else if (t == GoodsType.GoodsType_RIF) {\r\n            if (GameManager.instance.roleInfo.weaponType == PlayerData.WEAPON_RIFLE) {\r\n                GameManager.instance.roleInfo.bulletNum += GameManager.instance.roleInfo.addRifNum;\r\n            }\r\n            else {\r\n                GameManager.instance.roleInfo.bulletNum = GameManager.instance.roleInfo.addRifNum;\r\n                GameManager.instance.roleInfo.weaponType = PlayerData.WEAPON_RIFLE;\r\n            }\r\n            this.updateBulletNum();\r\n            EventManager.instance.dispatcherEvt(GameEvent.CHANGE_PLAYER_WEAPON, GameManager.instance.roleInfo.weaponType);\r\n            ViewManager.instance.createAddGold(t, GameManager.instance.roleInfo.addRifNum, true);\r\n        }\r\n        else if (t == GoodsType.GoodsType_GRE) {\r\n            GameManager.instance.roleInfo.bombNum += GameManager.instance.roleInfo.addBombNum;\r\n            this.updateGreNum();\r\n            ViewManager.instance.createAddGold(t, GameManager.instance.roleInfo.addBombNum, true);\r\n        }\r\n        else if (t == GoodsType.GoodsType_COIN) {\r\n            var coin = this.getRandomCoin();\r\n            GameManager.instance.roleInfo.curlvCoin += coin;\r\n            GameManager.instance.roleInfo.totalCoin += coin;\r\n            this.updateCoin();\r\n            ViewManager.instance.createAddGold(t, coin, true);\r\n        }\r\n        else if (t == GoodsType.GoodsType_BOX) {\r\n            if (GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO || GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n                this.showBoxGoods();\r\n                return;\r\n            }\r\n            if (MooSnowSDK.misTouchNum == 0) {\r\n                this.showBoxGoods();\r\n            }\r\n            else if (MooSnowSDK.misTouchNum > 0) {\r\n                GameManager.instance.misTouchNum++;\r\n                if (GameManager.instance.misTouchNum >= MooSnowSDK.misTouchNum) {\r\n                    GameManager.instance.misTouchNum = 0;\r\n                    ViewManager.instance.showClickChestView();\r\n                }\r\n                else {\r\n                    this.showBoxGoods();\r\n                }\r\n            }\r\n        }\r\n        else if (t == GoodsType.GoodsType_OPEN_BOX) {\r\n            this.showBoxGoods();\r\n        }\r\n    }\r\n    showBoxGoods() {\r\n        this.changePlayerGoods(GoodsType.GoodsType_MED);\r\n        Laya.timer.once(500, this, this.changePlayerGoods, [GoodsType.GoodsType_RIF]);\r\n        Laya.timer.once(1000, this, this.showGetGoods, [GoodsType.GoodsType_GRE]);\r\n    }\r\n    showGetGoods(t) {\r\n        this.changePlayerGoods(t);\r\n    }\r\n    decPlayerBlood() {\r\n        this.updatePlayerBlood();\r\n    }\r\n    usePlyerBullet() {\r\n        if (GameManager.instance.roleInfo.weaponType == PlayerData.WEAPON_PIS)\r\n            return;\r\n        GameManager.instance.roleInfo.bulletNum--;\r\n        if (GameManager.instance.roleInfo.bulletNum <= 0) {\r\n            GameManager.instance.roleInfo.weaponType = PlayerData.WEAPON_PIS;\r\n            EventManager.instance.dispatcherEvt(GameEvent.CHANGE_PLAYER_WEAPON, PlayerData.WEAPON_PIS);\r\n        }\r\n        this.updateBulletNum();\r\n    }\r\n    decBombNum() {\r\n        GameManager.instance.roleInfo.bombNum--;\r\n        this.updateGreNum();\r\n    }\r\n    updateBulletNum() {\r\n        this.view.m_bullet.text = GameManager.instance.roleInfo.bulletNum + \"\";\r\n    }\r\n    updateGreNum() {\r\n        this.view.m_gre.text = GameManager.instance.roleInfo.bombNum + \"\";\r\n    }\r\n    updateCoin() {\r\n        this.view.m_coin.text = GameManager.instance.roleInfo.totalCoin + \"\";\r\n        this.updateBuyItem();\r\n    }\r\n    updatePlayerBlood() {\r\n        if (GameManager.instance.roleInfo.blood == 6) {\r\n            this.view.m_blood_3.m_ctl.selectedIndex = this.view.m_blood_2.m_ctl.selectedIndex = this.view.m_blood_1.m_ctl.selectedIndex = 0;\r\n        }\r\n        else if (GameManager.instance.roleInfo.blood == 5) {\r\n            this.view.m_blood_2.m_ctl.selectedIndex = this.view.m_blood_1.m_ctl.selectedIndex = 0;\r\n            this.view.m_blood_3.m_ctl.selectedIndex = 1;\r\n        }\r\n        else if (GameManager.instance.roleInfo.blood == 4) {\r\n            this.view.m_blood_2.m_ctl.selectedIndex = this.view.m_blood_1.m_ctl.selectedIndex = 0;\r\n            this.view.m_blood_3.m_ctl.selectedIndex = 2;\r\n        }\r\n        else if (GameManager.instance.roleInfo.blood == 3) {\r\n            this.view.m_blood_1.m_ctl.selectedIndex = 0;\r\n            this.view.m_blood_2.m_ctl.selectedIndex = 1;\r\n            this.view.m_blood_3.m_ctl.selectedIndex = 2;\r\n        }\r\n        else if (GameManager.instance.roleInfo.blood == 2) {\r\n            this.view.m_blood_1.m_ctl.selectedIndex = 0;\r\n            this.view.m_blood_2.m_ctl.selectedIndex = 2;\r\n            this.view.m_blood_3.m_ctl.selectedIndex = 2;\r\n        }\r\n        else if (GameManager.instance.roleInfo.blood == 1) {\r\n            this.view.m_blood_1.m_ctl.selectedIndex = 1;\r\n            this.view.m_blood_2.m_ctl.selectedIndex = 2;\r\n            this.view.m_blood_3.m_ctl.selectedIndex = 2;\r\n        }\r\n        else {\r\n            this.view.m_blood_1.m_ctl.selectedIndex = 2;\r\n            this.view.m_blood_2.m_ctl.selectedIndex = 2;\r\n            this.view.m_blood_3.m_ctl.selectedIndex = 2;\r\n        }\r\n    }\r\n    initBuyItem() {\r\n        this.shopData = GameManager.instance.levelData.shop;\r\n        var index = 0;\r\n        for (const key in this.shopData) {\r\n            if (this.shopData.hasOwnProperty(key)) {\r\n                index++;\r\n                var d = this.shopData[key];\r\n                this.view[\"m_item_\" + index].m_coin.text = d.coin + \"\";\r\n                this.view[\"m_item_\" + index].m_info.text = \"x\" + d.num;\r\n                this.view[\"m_item_\" + index].m_icon.url = \"ui://Game/goods_\" + d.type;\r\n                this.view[\"m_item_\" + index].data = d;\r\n                this.view[\"m_item_\" + index].onClick(this, this.buyItem, [d]);\r\n            }\r\n        }\r\n    }\r\n    updateBuyItem() {\r\n        if (GameManager.instance.platform != moosnow.APP_PLATFORM.BYTEDANCE)\r\n            return;\r\n        for (let i = 1; i <= 3; i++) {\r\n            var d = this.view[\"m_item_\" + i].data;\r\n            if (!d)\r\n                continue;\r\n            if (d.coin > GameManager.instance.roleInfo.totalCoin) {\r\n                this.view[\"m_item_\" + i].m_ctl.selectedIndex = 1;\r\n            }\r\n            else {\r\n                this.view[\"m_item_\" + i].m_ctl.selectedIndex = 0;\r\n            }\r\n        }\r\n    }\r\n    buyItem(d) {\r\n        if (d.coin > GameManager.instance.roleInfo.totalCoin) {\r\n            this.watchVideo(d);\r\n        }\r\n        else {\r\n            this.buyItemSuccess(d);\r\n        }\r\n    }\r\n    buyItemSuccess(d) {\r\n        GameManager.instance.roleInfo.totalCoin -= d.coin;\r\n        this.changePlayerGoods(d.type);\r\n        this.updateCoin();\r\n        ViewManager.instance.showTipsView(\"恭喜获得：\" + d.name);\r\n    }\r\n    watchVideo(d) {\r\n        var v = GameManager.instance.createVideoData(VideoType.VIDEOTYPE_GOODS, VideoInfo.VIDEOINFO_GOODS);\r\n        MooSnowSDK.showVideo(d, v, this.changePlayerGoods.bind(this, [d.type]));\r\n    }\r\n    getRandomCoin() {\r\n        return Math.floor((Math.random() * 100) * GameData.RANDOM_COIN / 100);\r\n    }\r\n    getRandomGoodsType() {\r\n        return Math.ceil(Math.random() * 5);\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_PlayerInfoView.ts",
    "D:/littleGame/gunfire/src/Manager/GameManager.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Data/GameData.ts",
    "D:/littleGame/gunfire/src/Data/PlayerData.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/Manager/MooSnowSDK.ts",
    "D:/littleGame/gunfire/src/Data/VideoData.ts"
  ]
}
