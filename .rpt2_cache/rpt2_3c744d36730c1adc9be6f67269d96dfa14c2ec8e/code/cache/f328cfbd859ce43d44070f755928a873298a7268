{
  "code": "import { ViewManager } from \"../Manager/ViewManager\";\r\nimport EnemyBody from \"./Body/EnemyBody\";\r\nimport GameEvent from \"../Control/GameEvent\";\r\nimport { EventManager } from \"../Manager/EventManager\";\r\nimport { GameData, ShotDirectionData, BombData } from \"../Data/GameData\";\r\nimport { GameManager } from \"../Manager/GameManager\";\r\nimport { SoundManager } from \"../Manager/SoundManager\";\r\nimport { ui } from \"../ui/layaMaxUI\";\r\nimport { MooSnowSDK } from \"../Manager/MooSnowSDK\";\r\nexport default class Enemy {\r\n    constructor() {\r\n        this.enemyType = 5;\r\n        this.direction = 0;\r\n        this.sRun = false;\r\n        this.keyRight = false;\r\n        this.keyLeft = false;\r\n        this.keyJump = false;\r\n        this.speed = 10;\r\n        this.jumpHigh = 200;\r\n        this.isDeath = false;\r\n        this.blood = 1;\r\n        this.expRate = [];\r\n        this.isBoss = false;\r\n        this.isActive = false;\r\n        this.name = \"\";\r\n    }\r\n    createView(d) {\r\n        this.initData(d);\r\n        this.scene = new ui.EnemyBodyUI();\r\n        this.loadComplete();\r\n    }\r\n    ;\r\n    initData(d) {\r\n        this.enemyData = d;\r\n        this.direction = d.direction;\r\n        this.enemyType = d.type;\r\n        this.blood = d.blood;\r\n        this.damage = d.damage;\r\n        this.activeDis = d.activeDis;\r\n        this.pos = d.pos;\r\n        this.expRate = d.expRate.concat();\r\n        this.isBoss = d.isBoss;\r\n        this.isActive = false;\r\n        this.isDeath = false;\r\n        this.name = d.name;\r\n        Laya.timer.clear(this, this.setFire);\r\n    }\r\n    loadComplete() {\r\n        this.view = fairygui.UIPackage.createObject(\"Game\", \"enemy\");\r\n        this.view.setPivot(0.5, 0.5);\r\n        this.enemy = this.view.getChildAt(0);\r\n        this.initView();\r\n    }\r\n    ;\r\n    initView() {\r\n        this.enemy.url = \"ui://Game/enemy\" + this.enemyType;\r\n        this.scene.addChild(this.enemy.displayObject);\r\n        this.scene.addComponent(EnemyBody);\r\n        this.box = this.scene.getComponent(Laya.BoxCollider);\r\n        this.body = this.scene.getComponent(Laya.RigidBody);\r\n        this.scene.x = this.pos.x;\r\n        this.scene.y = this.pos.y;\r\n        ViewManager.instance.warView.scene.addChild(this.scene);\r\n        this.enemyScript = this.scene.getComponent(EnemyBody);\r\n        if (this.enemyType == GameData.ENEMY_JUNGUAN) {\r\n            this.enemyScript.activeDis = 900;\r\n        }\r\n        EventManager.instance.addNotice(GameEvent.PLAYER_BULLET_HIT_ENEMY, this, this.beHit);\r\n        EventManager.instance.addNotice(GameEvent.PLAYER_BOMB_HIT_ENEMY, this, this.beHit);\r\n        EventManager.instance.addNotice(GameEvent.PAUSE_GAME, this, this.pauseGame);\r\n        EventManager.instance.addNotice(GameEvent.ACTIVE_ENEMY, this, this.activeEnemy);\r\n        EventManager.instance.addNotice(GameEvent.CLEAR_WAR_VIEW, this, this.clearWarView);\r\n        EventManager.instance.addNotice(GameEvent.OBSTACLE_BOOM, this, this.obstacleBoom);\r\n        EventManager.instance.addNotice(GameEvent.PLAYER_PAN_HIT_ENEMY, this, this.beHit);\r\n        this.setDirection();\r\n        this.setStay();\r\n        this.showEnemyName();\r\n    }\r\n    activeEnemy(s) {\r\n        if (this.isActive)\r\n            return;\r\n        if (this.isDeath)\r\n            return;\r\n        if (this.box.owner == s) {\r\n            this.isActive = true;\r\n            this.setFire();\r\n            Laya.timer.loop(3000, this, this.setFire);\r\n        }\r\n    }\r\n    pauseGame() {\r\n        if (this.isDeath)\r\n            return;\r\n        this.bodyLoader.playing = !GameManager.instance.isPauseGame;\r\n        if (this.enemyType == GameData.ENEMY_MOR) {\r\n            this.bodyLoader.component.getChildAt(0).asLoader.playing = !GameManager.instance.isPauseGame;\r\n            this.bodyLoader.component.getChildAt(1).asMovieClip.playing = !GameManager.instance.isPauseGame;\r\n        }\r\n    }\r\n    obstacleBoom(s) {\r\n        if (this.enemyScript.obstacleBox && this.enemyScript.obstacleBox.owner && s == this.enemyScript.obstacleBox.owner) {\r\n            this.body.gravityScale = 2;\r\n            this.box.density = 5;\r\n            this.body.setVelocity({ x: 0, y: 1 });\r\n            this.box.refresh();\r\n            this.enemyScript.isDrop = true;\r\n            console.log(\"obstacleBoom--\");\r\n        }\r\n    }\r\n    beHit(s) {\r\n        if (this.isDeath)\r\n            return;\r\n        if (s.o == this.box.owner) {\r\n            this.blood -= s.d;\r\n            Laya.timer.clear(this, this.setColor);\r\n            if (this.blood <= 0) {\r\n                this.setDeath();\r\n            }\r\n            else {\r\n                if (this.enemyType == GameData.ENEMY_MOR) {\r\n                    this.bodyLoader.component.getChildAt(0).asLoader.content.color = \"#ff0000\";\r\n                    this.bodyLoader.component.getChildAt(1).asMovieClip.color = \"#ff0000\";\r\n                }\r\n                else\r\n                    this.bodyLoader.color = \"#ff0000\";\r\n                Laya.timer.once(200, this, this.setColor);\r\n                ViewManager.instance.createDamageView(s.d, this.scene);\r\n            }\r\n        }\r\n    }\r\n    setColor() {\r\n        if (this.enemyType == GameData.ENEMY_MOR) {\r\n            this.bodyLoader.component.getChildAt(0).asLoader.content.color = \"#ffffff\";\r\n            this.bodyLoader.component.getChildAt(1).asMovieClip.color = \"#ffffff\";\r\n        }\r\n        else\r\n            this.bodyLoader.color = \"#ffffff\";\r\n    }\r\n    setDirection() {\r\n        if (this.direction == ShotDirectionData.LEFT) {\r\n            this.bodyLoader.skewY = 0;\r\n        }\r\n        else {\r\n            this.bodyLoader.skewY = 180;\r\n        }\r\n    }\r\n    setIdle() {\r\n        if (this.isDeath)\r\n            return;\r\n        if (this.enemyType == GameData.ENEMY_PIS || this.enemyType == GameData.ENEMY_GRE) {\r\n            this.bodyLoader.url = \"ui://Game/enemyIdle_1\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_MAC) {\r\n            this.bodyLoader.url = \"ui://Game/enemyIdle_2\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_FIRE) {\r\n            this.bodyLoader.url = \"ui://Game/enemyStay_4\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_MOR) {\r\n            this.bodyLoader.url = \"ui://Game/enemyStay_5\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_JUNGUAN) {\r\n            this.bodyLoader.url = \"ui://Game/enemyStay_6\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_TANK_1) {\r\n            this.bodyLoader.url = \"ui://Game/enemy11\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_TANK_2) {\r\n            this.bodyLoader.url = \"ui://Game/enemy12\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_TANK_3) {\r\n            this.bodyLoader.url = \"ui://Game/enemy13\";\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_TANK_4) {\r\n            this.bodyLoader.url = \"ui://Game/enemy14\";\r\n        }\r\n        this.bodyLoader.content.setPlaySettings(0, -1, 0, 0);\r\n    }\r\n    setRun() {\r\n        if (this.isDeath)\r\n            return;\r\n        if (this.sRun)\r\n            return;\r\n        this.bodyLoader.url = \"ui://Game/enemy_run_\" + this.enemyType;\r\n    }\r\n    stillRun() {\r\n        if (this.isDeath)\r\n            return;\r\n        if (this.direction == 1) {\r\n            this.scene.x += this.speed;\r\n            if (this.scene.x >= Laya.Browser.clientWidth / 2) {\r\n                this.scene.x = Laya.Browser.clientWidth / 2;\r\n            }\r\n        }\r\n        else {\r\n            this.scene.x -= this.speed;\r\n            if (this.scene.x < 1)\r\n                this.scene.x = 1;\r\n        }\r\n    }\r\n    setFire() {\r\n        if (this.isDeath)\r\n            return;\r\n        if (this.enemyType == GameData.ENEMY_PIS || this.enemyType == GameData.ENEMY_GRE) {\r\n            if (this.getRandomFire() == 1) {\r\n                SoundManager.instance.playSound(\"enemy_fire\");\r\n                this.bodyLoader.url = \"ui://Game/enemy_fire_1\";\r\n                this.bodyLoader.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.shotComplete));\r\n            }\r\n            else {\r\n                this.bodyLoader.url = \"ui://Game/enemy_fire_2\";\r\n                this.bodyLoader.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.bombComplete));\r\n            }\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_MAC) {\r\n            SoundManager.instance.playSound(\"enemy_fire\");\r\n            this.bodyLoader.url = \"ui://Game/enemy_fire_3\";\r\n            this.bodyLoader.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.shot2Complete));\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_FIRE) {\r\n            SoundManager.instance.playSound(\"BombDrop\");\r\n            this.bodyLoader.url = \"ui://Game/enemy_fire_4\";\r\n            this.bodyLoader.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.shot4Complete));\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_MOR) {\r\n            SoundManager.instance.playSound(\"BombDrop\");\r\n            this.bodyLoader.url = \"ui://Game/enemy_fire_5\";\r\n            this.bodyLoader.component.getChildAt(0).asLoader.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.morComplete));\r\n            this.bodyLoader.component.getChildAt(1).asMovieClip.setPlaySettings(0, -1, 1, 0);\r\n        }\r\n        else if (this.enemyType == GameData.ENEMY_JUNGUAN) {\r\n            SoundManager.instance.playSound(\"enemy_fire\");\r\n            this.bodyLoader.url = \"ui://Game/enemy_fire_6\";\r\n            this.bodyLoader.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.shot2Complete));\r\n        }\r\n        else {\r\n            console.log(\"没有对应的敌人攻击效果\");\r\n        }\r\n    }\r\n    setDeath() {\r\n        if (this.isDeath)\r\n            return;\r\n        this.isDeath = true;\r\n        Laya.timer.clear(this, this.setFire);\r\n        var s = this.getRandomDeath();\r\n        SoundManager.instance.playSound(\"die_\" + s);\r\n        if (this.enemyType == GameData.ENEMY_JUNGUAN) {\r\n            this.enemy.url = \"ui://Game/death_\" + this.enemyType;\r\n        }\r\n        else\r\n            this.enemy.url = \"ui://Game/death_\" + s;\r\n        this.enemy.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.dispose));\r\n        Laya.timer.once(500, this, this.dispose);\r\n        this.createGoods();\r\n        if (this.isBoss) {\r\n            MooSnowSDK.clipRecord();\r\n            GameManager.instance.victoryGame();\r\n        }\r\n    }\r\n    morComplete() {\r\n        ViewManager.instance.createBomb(BombData.BOMB_MOR, this.direction, ViewManager.instance.getBodyCenterPos(this.scene), false);\r\n        this.setIdle();\r\n    }\r\n    shotComplete() {\r\n        ViewManager.instance.createEnemyBullet(GameData.ENEMY_PIS, this.direction, ViewManager.instance.getBodyCenterPos(this.scene));\r\n        this.setIdle();\r\n    }\r\n    shot2Complete() {\r\n        ViewManager.instance.createEnemyBullet(GameData.ENEMY_MAC, this.direction, ViewManager.instance.getBodyCenterPos(this.scene));\r\n        this.setIdle();\r\n    }\r\n    shot4Complete() {\r\n        ViewManager.instance.createBomb(BombData.BOMB_FIRE, this.direction, ViewManager.instance.getBodyCenterPos(this.scene), false);\r\n        this.setIdle();\r\n    }\r\n    bombComplete() {\r\n        ViewManager.instance.createBomb(BombData.BOMB_ENEMY_GRE, this.direction, ViewManager.instance.getBodyCenterPos(this.scene), false);\r\n        this.setIdle();\r\n    }\r\n    tankeComplete() {\r\n    }\r\n    setStay() {\r\n        this.setIdle();\r\n    }\r\n    setBoomComplete() {\r\n        this.setStay();\r\n    }\r\n    createGoods() {\r\n        if (this.expRate.length > 0) {\r\n            var r = Math.random();\r\n            var rate = 0;\r\n            var type = 0;\r\n            for (let i = 0; i < this.expRate.length; i += 2) {\r\n                rate += this.expRate[i + 1];\r\n                if (rate >= r) {\r\n                    type = this.expRate[i];\r\n                    if (type > 0) {\r\n                        var p = new Laya.Point();\r\n                        p.x = this.scene.x + this.scene.width / 2;\r\n                        p.y = this.scene.y + this.scene.height / 2;\r\n                        ViewManager.instance.createGoods(type, p);\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    clearWarView() {\r\n        this.dispose();\r\n    }\r\n    dispose() {\r\n        EventManager.instance.offNotice(GameEvent.CLEAR_WAR_VIEW, this, this.clearWarView);\r\n        EventManager.instance.offNotice(GameEvent.ACTIVE_ENEMY, this, this.activeEnemy);\r\n        EventManager.instance.offNotice(GameEvent.PAUSE_GAME, this, this.pauseGame);\r\n        EventManager.instance.offNotice(GameEvent.PLAYER_BULLET_HIT_ENEMY, this, this.beHit);\r\n        EventManager.instance.offNotice(GameEvent.OBSTACLE_BOOM, this, this.obstacleBoom);\r\n        EventManager.instance.offNotice(GameEvent.PLAYER_PAN_HIT_ENEMY, this, this.beHit);\r\n        Laya.timer.clearAll(this);\r\n        if (this.scene) {\r\n            this.enemyScript.isRemove = true;\r\n            this.scene.removeSelf();\r\n        }\r\n        if (this.view)\r\n            this.view.dispose();\r\n        this.recover();\r\n    }\r\n    recover() {\r\n        Laya.Pool.recover(\"enenmy\", this);\r\n    }\r\n    get component() {\r\n        return this.enemy.component;\r\n    }\r\n    get bodyLoader() {\r\n        return this.enemy.component.getChildAt(0).asLoader;\r\n    }\r\n    getRandomFire() {\r\n        if (Math.random() > 0.5)\r\n            return 1;\r\n        return 2;\r\n    }\r\n    getRandomDeath() {\r\n        var r = Math.random();\r\n        if (r > 0.75)\r\n            return 4;\r\n        if (r > 0.5)\r\n            return 3;\r\n        if (r > 0.25)\r\n            return 2;\r\n        return 1;\r\n    }\r\n    showEnemyName() {\r\n        if (!GameData.SHOW_ENEMY_NAME)\r\n            return;\r\n        var txt = new Laya.Text();\r\n        txt.width = 50;\r\n        txt.height = 30;\r\n        txt.fontSize = 20;\r\n        txt.color = \"#ffff00\";\r\n        txt.text = this.name;\r\n        this.enemy.displayObject.addChild(txt);\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/View/Body/EnemyBody.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Data/GameData.ts",
    "D:/littleGame/gunfire/src/Data/PlayerData.ts",
    "D:/littleGame/gunfire/src/Manager/GameManager.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/ui/layaMaxUI.ts",
    "D:/littleGame/gunfire/src/Manager/MooSnowSDK.ts"
  ]
}
