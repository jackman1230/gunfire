{
  "code": "import { ViewManager } from \"../Manager/ViewManager\";\r\nimport GameEvent from \"../Control/GameEvent\";\r\nimport { EventManager } from \"../Manager/EventManager\";\r\nimport { GameData, ObstacleType } from \"../Data/GameData\";\r\nimport { ui } from \"../ui/layaMaxUI\";\r\nexport default class ObstacleView {\r\n    constructor() {\r\n        this.type = 1;\r\n        this.direction = 0;\r\n        this.isDeath = false;\r\n        this.blood = 1;\r\n        this.name = \"\";\r\n    }\r\n    createView(d) {\r\n        this.type = d.type;\r\n        this.blood = d.blood;\r\n        this.pos = d.pos;\r\n        this.name = d.name;\r\n        if (this.type == ObstacleType.ObstacleType_SHABAO) {\r\n            this.scene = new ui.ObstacleView_1UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_YOUGUAN) {\r\n            this.scene = new ui.ObstacleView_2UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_MICHE) {\r\n            this.scene = new ui.ObstacleView_3UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_DACHE) {\r\n            this.scene = new ui.ObstacleView_4UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_CHE) {\r\n            this.scene = new ui.ObstacleView_5UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_6) {\r\n            this.scene = new ui.ObstacleView_6UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_7) {\r\n            this.scene = new ui.ObstacleView_7UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_8) {\r\n            this.scene = new ui.ObstacleView_8UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_9) {\r\n            this.scene = new ui.ObstacleView_9UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_10) {\r\n            this.scene = new ui.ObstacleView_10UI();\r\n        }\r\n        else if (this.type == ObstacleType.ObstacleType_11) {\r\n            this.scene = new ui.ObstacleView_11UI();\r\n        }\r\n        else\r\n            return;\r\n        this.loadComplete();\r\n    }\r\n    ;\r\n    loadComplete() {\r\n        this.view = fairygui.UIPackage.createObject(\"Game\", \"obstacleView\");\r\n        this.view.setPivot(0.5, 0.5);\r\n        this.load = this.view.getChildAt(0);\r\n        this.initView();\r\n    }\r\n    ;\r\n    initView() {\r\n        this.load.url = \"ui://Game/obstacle_\" + this.type;\r\n        this.scene.addChild(this.view.displayObject);\r\n        this.box = this.scene.getComponent(Laya.PolygonCollider);\r\n        this.isDeath = false;\r\n        this.scene.x = this.pos.x;\r\n        this.scene.y = this.pos.y;\r\n        ViewManager.instance.warView.scene.addChild(this.scene);\r\n        EventManager.instance.addNotice(GameEvent.CLEAR_WAR_VIEW, this, this.dispose);\r\n        EventManager.instance.addNotice(GameEvent.PLAYER_BOMB_HIT_OBSTACLE, this, this.beHit);\r\n        EventManager.instance.addNotice(GameEvent.PLAYER_BULLET_HIT_OBSTACLE, this, this.beHit);\r\n        this.showEnemyName();\r\n    }\r\n    beHit(s) {\r\n        if (this.isDeath)\r\n            return;\r\n        if (s.o == this.box.owner) {\r\n            this.blood -= s.d;\r\n            Laya.timer.clear(this, this.setColor);\r\n            if (this.blood <= 0) {\r\n                this.setDeath();\r\n            }\r\n            else {\r\n                this.load.color = \"#ff0000\";\r\n                Laya.timer.once(200, this, this.setColor);\r\n            }\r\n        }\r\n    }\r\n    setColor() {\r\n        this.load.color = \"#ffffff\";\r\n    }\r\n    setDeath() {\r\n        this.isDeath = true;\r\n        Laya.timer.clearAll(this);\r\n        this.load.url = \"\";\r\n        var boomAniType = ViewManager.instance.getBoomAniTypeByObsType(this.type);\r\n        var boomAni = fairygui.UIPackage.createObject(\"Game\", \"boom_\" + boomAniType).asMovieClip;\r\n        var p = this.getBoomAniPos(this.type);\r\n        boomAni.x = p.x;\r\n        boomAni.y = p.y;\r\n        this.load.displayObject.addChild(boomAni.displayObject);\r\n        boomAni.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.dispose));\r\n    }\r\n    dispose() {\r\n        EventManager.instance.offNotice(GameEvent.CLEAR_WAR_VIEW, this, this.dispose);\r\n        EventManager.instance.offNotice(GameEvent.PLAYER_BOMB_HIT_OBSTACLE, this, this.beHit);\r\n        EventManager.instance.offNotice(GameEvent.PLAYER_BULLET_HIT_OBSTACLE, this, this.beHit);\r\n        Laya.timer.clearAll(this);\r\n        if (this.scene)\r\n            this.scene.removeSelf();\r\n        if (this.view)\r\n            this.view.dispose();\r\n        Laya.Pool.recover(\"obstacle\", this);\r\n        EventManager.instance.dispatcherEvt(GameEvent.OBSTACLE_BOOM, this.box.owner);\r\n    }\r\n    getBoomAniPos(type) {\r\n        var p = new Laya.Point();\r\n        if (type == ObstacleType.ObstacleType_SHABAO) {\r\n            p.x = 10;\r\n            p.y = -10;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_YOUGUAN) {\r\n            p.x = -10;\r\n            p.y = -10;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_MICHE) {\r\n            p.x = -20;\r\n            p.y = -180;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_DACHE) {\r\n            p.x = 250;\r\n            p.y = -40;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_CHE) {\r\n            p.x = 50;\r\n            p.y = -100;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_6) {\r\n            p.x = -50;\r\n            p.y = -100;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_7) {\r\n            p.x = -40;\r\n            p.y = -200;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_8) {\r\n            p.x = -60;\r\n            p.y = -220;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_9) {\r\n            p.x = -10;\r\n            p.y = -10;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_10) {\r\n            p.x = 20;\r\n            p.y = -120;\r\n        }\r\n        else if (type == ObstacleType.ObstacleType_11) {\r\n            p.x = -30;\r\n            p.y = -150;\r\n        }\r\n        return p;\r\n    }\r\n    showEnemyName() {\r\n        if (!GameData.SHOW_ENEMY_NAME)\r\n            return;\r\n        var txt = new Laya.Text();\r\n        txt.width = 50;\r\n        txt.height = 30;\r\n        txt.fontSize = 20;\r\n        txt.color = \"#ffff00\";\r\n        txt.text = this.name;\r\n        this.load.displayObject.addChild(txt);\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Data/GameData.ts",
    "D:/littleGame/gunfire/src/Data/PlayerData.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/ui/layaMaxUI.ts",
    "D:/littleGame/gunfire/src/View/BoomView.ts",
    "D:/littleGame/gunfire/src/View/Body/ObstacleBoomBody.ts"
  ]
}
