{
  "code": "import { ViewManager } from \"./ViewManager\";\r\nimport { PlayerInfo, EnemyInfo, ObstacleInfo, PlayerData } from \"../Data/PlayerData\";\r\nimport { GameData, GoodsType } from \"../Data/GameData\";\r\nimport { EventManager } from \"./EventManager\";\r\nimport GameEvent from \"../Control/GameEvent\";\r\nimport { SoundManager } from \"./SoundManager\";\r\nimport { SaveManager } from \"./SaveManager\";\r\nimport { MooSnowSDK } from \"./MooSnowSDK\";\r\nimport { VideoData, VideoType } from \"../Data/VideoData\";\r\nexport class GameManager {\r\n    constructor() {\r\n        this.curLevel = 1;\r\n        this.curChapter = 1;\r\n        this.maxLevel = 8;\r\n        this.maxChapter = 1;\r\n        this.gotoMaxLevel = 1;\r\n        this.gotoMaxChapter = 1;\r\n        this.choiseLevel = 1;\r\n        this.enemyArr = [];\r\n        this.misTouchNum = 0;\r\n        this.adOriList = [];\r\n        this.adList = [];\r\n        this.adListRever = [];\r\n        this.adTime = 0;\r\n        this.buyWeaponType = 0;\r\n        this.buyBullet = 0;\r\n        this.buyGre = 10;\r\n        this.platform = 0;\r\n        this.isPauseGame = false;\r\n        this.oriBlood = 6;\r\n    }\r\n    static get instance() {\r\n        if (this._instance == null)\r\n            this._instance = new GameManager();\r\n        return this._instance;\r\n    }\r\n    startGame() {\r\n        this.levelData = Laya.loader.getRes(\"res/LevelData.json\");\r\n        var levelData2 = Laya.loader.getRes(\"res/LevelData2.json\");\r\n        this.levelData[\"chapter_4\"] = levelData2[\"chapter_4\"];\r\n        this.levelData[\"chapter_5\"] = levelData2[\"chapter_5\"];\r\n        this.platform = MooSnowSDK.getPlatform();\r\n        console.log(this.levelData);\r\n        this.initRoleData();\r\n        this.initChapterConfig();\r\n        SoundManager.instance.openSound();\r\n        ViewManager.instance.initPopUpView();\r\n        ViewManager.instance.showChapterView();\r\n    }\r\n    initChapterConfig() {\r\n        this.maxChapter = this.levelData[\"maxChapter\"];\r\n        var l = SaveManager.instance.getGameData(\"level\");\r\n        var c = SaveManager.instance.getGameData(\"chapter\");\r\n        var coin = SaveManager.instance.getGameData(\"coin\");\r\n        if (coin && coin.length > 0)\r\n            this.roleInfo.totalCoin = Number(coin);\r\n        if (l && l.length > 0) {\r\n            this.curLevel = this.gotoMaxLevel = Number(l);\r\n            this.curChapter = this.gotoMaxChapter = Math.ceil(this.curLevel / this.maxLevel);\r\n            if (this.curChapter > this.maxChapter)\r\n                this.curChapter = this.gotoMaxChapter = this.maxChapter;\r\n        }\r\n        else {\r\n            this.gotoMaxChapter = this.curChapter = 1;\r\n            this.gotoMaxLevel = this.curLevel = 1;\r\n        }\r\n        this.maxLevel = this.levelData[\"chapter_\" + this.curChapter].maxLevelNum;\r\n    }\r\n    enterGame() {\r\n        this.curLevel = this.choiseLevel;\r\n        this.goLevelGame();\r\n    }\r\n    continueGameByVideo() {\r\n        this.roleInfo.isDeath = false;\r\n        this.roleInfo.blood = this.oriBlood;\r\n        this.roleInfo.isInvincible = true;\r\n        ViewManager.instance.playerInfoView.updatePlayerBlood();\r\n        ViewManager.instance.hidePopUpView(ViewManager.instance.afterWar);\r\n        ViewManager.instance.player.playerRes();\r\n    }\r\n    goBack() {\r\n        this.goFirstPage();\r\n    }\r\n    goFirstPage(end = false) {\r\n        this.enemyArr.length = 0;\r\n        EventManager.instance.dispatcherEvt(GameEvent.CLEAR_WAR_VIEW);\r\n        ViewManager.instance.hidePopUpView(null, true);\r\n        ViewManager.instance.removeWarView();\r\n        ViewManager.instance.showChapterView();\r\n        if (end && GameManager.instance.platform == moosnow.APP_PLATFORM.VIVO) {\r\n            Laya.timer.once(500, this, () => {\r\n                MooSnowSDK.installShortcut();\r\n            });\r\n        }\r\n        if (end && GameManager.instance.platform == moosnow.APP_PLATFORM.OPPO) {\r\n            Laya.timer.once(500, this, () => {\r\n                MooSnowSDK.installShortcut();\r\n            });\r\n        }\r\n    }\r\n    suspendGame() {\r\n        this.isPauseGame = !this.isPauseGame;\r\n        if (GameManager.instance.isPauseGame) {\r\n            Laya.updateTimer.pause();\r\n            Laya.physicsTimer.pause();\r\n            Laya.timer.pause();\r\n        }\r\n        else {\r\n            Laya.updateTimer.resume();\r\n            Laya.physicsTimer.resume();\r\n            Laya.timer.resume();\r\n        }\r\n        EventManager.instance.dispatcherEvt(GameEvent.PAUSE_GAME);\r\n    }\r\n    victoryGame() {\r\n        ViewManager.instance.playerVicToryLevel();\r\n        this.curLevel++;\r\n        if (this.gotoMaxLevel < this.curLevel) {\r\n            this.gotoMaxLevel = this.curLevel;\r\n            if (this.gotoMaxLevel % this.maxLevel == 1) {\r\n                this.gotoMaxChapter++;\r\n                if (this.gotoMaxChapter > this.maxChapter)\r\n                    this.gotoMaxChapter = this.maxChapter;\r\n                this.curChapter = this.gotoMaxChapter;\r\n            }\r\n        }\r\n        else {\r\n            this.curChapter = Math.ceil(this.curLevel / this.maxLevel);\r\n        }\r\n        ViewManager.instance.showAfterWarView(1);\r\n        SaveManager.instance.saveGameData(\"level\", this.gotoMaxLevel + \"\");\r\n        SaveManager.instance.saveGameData(\"chapter\", this.gotoMaxChapter + \"\");\r\n        SaveManager.instance.saveGameData(\"coin\", this.roleInfo.totalCoin + \"\");\r\n        SoundManager.instance.playSound(\"gameOver\");\r\n    }\r\n    restartGame() {\r\n        ViewManager.instance.hidePopUpView(null, true);\r\n        if (this.curLevel < 1)\r\n            this.curLevel = 1;\r\n        this.goLevelGame();\r\n    }\r\n    gotoNextLevel() {\r\n        ViewManager.instance.hidePopUpView(ViewManager.instance.afterWar);\r\n        if (this.curLevel > this.maxLevel * this.maxChapter) {\r\n            ViewManager.instance.showTipsView(\"您已通关！敬请期待后续章节\");\r\n            return;\r\n        }\r\n        this.goLevelGame();\r\n    }\r\n    goLevelGame() {\r\n        ViewManager.instance.hidePopUpView(null, true);\r\n        if (this.curLevel > this.maxLevel * this.maxChapter) {\r\n            ViewManager.instance.showTipsView(\"您已通关！敬请期待后续章节\");\r\n            return;\r\n        }\r\n        EventManager.instance.dispatcherEvt(GameEvent.CLEAR_WAR_VIEW);\r\n        if (this.levelData[\"chapter_\" + this.curChapter]) {\r\n            var l = (this.curLevel % this.maxLevel);\r\n            if (l == 0)\r\n                l = 8;\r\n            this.maxLevel = this.levelData[\"chapter_\" + this.curChapter].maxLevelNum;\r\n            this.curLevelData = this.levelData[\"chapter_\" + this.curChapter][\"level_\" + l];\r\n            this.playerInfo.curlvCoin = 0;\r\n            this.roleInfo.blood = this.oriBlood;\r\n            this.roleInfo.isDeath = false;\r\n            ViewManager.instance.createWarView();\r\n            SoundManager.instance.playBGM(\"bgm\");\r\n            MooSnowSDK.startGame(GameManager.instance.choiseLevel);\r\n            MooSnowSDK.startRecord();\r\n        }\r\n        else {\r\n            ViewManager.instance.showTipsView(\"您已通关！敬请期待后续章节\");\r\n        }\r\n    }\r\n    showVideoResp(d, v, successFun) {\r\n        if (v.type == VideoType.VIDEOTYPE_ITEM && d) {\r\n            GameManager.instance.buyShopItem(d, true);\r\n            ViewManager.instance.beforeWar.updateView();\r\n        }\r\n        else if (v.type == VideoType.VIDEOTYPE_LIFE) {\r\n            GameManager.instance.continueGameByVideo();\r\n        }\r\n        else if (v.type == VideoType.VIDEOTYPE_DOUBLE_COIN) {\r\n            GameManager.instance.roleInfo.totalCoin += GameManager.instance.roleInfo.curlvCoin;\r\n            ViewManager.instance.playerInfoView.updateCoin();\r\n            GameManager.instance.goFirstPage();\r\n            MooSnowSDK.endGame(GameManager.instance.choiseLevel, true);\r\n            ViewManager.instance.showTipsView(\"额外获得金币：\" + GameManager.instance.roleInfo.curlvCoin);\r\n        }\r\n        else if (v.type == VideoType.VIDEOTYPE_TREBLE_COIN) {\r\n            GameManager.instance.roleInfo.totalCoin += GameManager.instance.roleInfo.curlvCoin * 2;\r\n            ViewManager.instance.playerInfoView.updateCoin();\r\n            GameManager.instance.goFirstPage();\r\n            MooSnowSDK.endGame(GameManager.instance.choiseLevel, true);\r\n            ViewManager.instance.showTipsView(\"额外获得金币：\" + GameManager.instance.roleInfo.curlvCoin * 2);\r\n        }\r\n        else if (v.type == VideoType.VIDEOTYPE_BOX) {\r\n            ViewManager.instance.playerInfoView.showBoxGoods();\r\n        }\r\n        if (successFun) {\r\n            successFun();\r\n        }\r\n    }\r\n    initRoleData() {\r\n        if (!this.playerInfo)\r\n            this.playerInfo = new PlayerInfo();\r\n        this.playerInfo.bombNum = this.levelData.role.bombNum;\r\n        this.playerInfo.weaponType = this.levelData.role.weaponType;\r\n        this.oriBlood = this.playerInfo.blood = this.levelData.role.blood;\r\n        this.playerInfo.addBombNum = this.levelData.role.addBombNum;\r\n        this.playerInfo.addMacNum = this.levelData.role.addMacNum;\r\n        this.playerInfo.addRifNum = this.levelData.role.addRifNum;\r\n        this.playerInfo.curLevel = this.playerInfo.curChapter = 1;\r\n        this.playerInfo.curlvCoin = this.playerInfo.totalCoin = 0;\r\n    }\r\n    createEnemyData() {\r\n        var enemyArr = this.curLevelData.enemyArr;\r\n        for (const key in enemyArr) {\r\n            if (enemyArr.hasOwnProperty(key)) {\r\n                var t = enemyArr[key];\r\n                var e;\r\n                var d = new EnemyInfo();\r\n                d.expRate = t.expRate.concat();\r\n                d.pos = new Laya.Point(t.pos[0], t.pos[1]);\r\n                d.activeDis = t.activeDis;\r\n                d.damage = t.damage;\r\n                d.blood = t.blood;\r\n                d.direction = t.direction;\r\n                d.isBoss = t.isBoss;\r\n                d.type = t.type;\r\n                d.name = key;\r\n                if (d.type == GameData.ENEMY_TANK_1 || d.type == GameData.ENEMY_TANK_2 || d.type == GameData.ENEMY_TANK_3 || d.type == GameData.ENEMY_TANK_4) {\r\n                    e = ViewManager.instance.createTank(d);\r\n                }\r\n                else if (d.type == GameData.ENEMY_CHOPPER) {\r\n                    e = ViewManager.instance.createChopper(d);\r\n                }\r\n                else if (d.type == GameData.HOSTAGE) {\r\n                    ViewManager.instance.createHostage(d);\r\n                }\r\n                else {\r\n                    e = ViewManager.instance.createEnemy(d);\r\n                }\r\n                this.enemyArr.push(e);\r\n            }\r\n        }\r\n    }\r\n    createObstacleData() {\r\n        var obstacle = GameManager.instance.curLevelData.obstacle;\r\n        for (const key in obstacle) {\r\n            if (obstacle.hasOwnProperty(key)) {\r\n                var t = obstacle[key];\r\n                var d = new ObstacleInfo();\r\n                d.pos = new Laya.Point(t.pos[0], t.pos[1]);\r\n                d.blood = t.blood;\r\n                d.type = t.type;\r\n                d.name = key;\r\n                ViewManager.instance.createObstacle(d);\r\n            }\r\n        }\r\n    }\r\n    buyShopItem(d, showTip = false) {\r\n        if (d.type == GoodsType.GoodsType_MED) {\r\n            GameManager.instance.roleInfo.blood += 2;\r\n        }\r\n        else if (d.type == GoodsType.GoodsType_MAC) {\r\n            if (this.buyWeaponType != PlayerData.WEAPON_MAC)\r\n                this.buyBullet = 0;\r\n            this.buyWeaponType = PlayerData.WEAPON_MAC;\r\n            this.buyBullet += d.num;\r\n        }\r\n        else if (d.type == GoodsType.GoodsType_GRE) {\r\n            this.buyGre += d.num;\r\n        }\r\n        else if (d.type == GoodsType.GoodsType_RIF) {\r\n            if (this.buyWeaponType != PlayerData.WEAPON_RIFLE)\r\n                this.buyBullet = 0;\r\n            this.buyWeaponType = PlayerData.WEAPON_RIFLE;\r\n            this.buyBullet += d.num;\r\n        }\r\n        if (showTip) {\r\n            ViewManager.instance.showTipsView(\"恭喜获得：\" + d.name);\r\n        }\r\n        if (this.buyBullet > 999)\r\n            this.buyBullet = 999;\r\n        if (this.buyGre > 999)\r\n            this.buyGre = 999;\r\n    }\r\n    setADlist() {\r\n        this.adOriList = this.adList.concat();\r\n        if (this.adList.length <= 5) {\r\n            this.adList.push(...this.adList);\r\n        }\r\n        this.adTime = this.adList.length * 1200;\r\n        this.adListRever = this.adList.concat().reverse();\r\n        EventManager.instance.dispatcherEvt(GameEvent.SHOW_AD_LIST);\r\n    }\r\n    useWeaponPan(x, y, dir) {\r\n        if (dir > 0)\r\n            x -= 50;\r\n        else\r\n            x += 50;\r\n        for (let i = 0; i < this.enemyArr.length; i++) {\r\n            var e = this.enemyArr[i];\r\n            if (e.isDeath)\r\n                continue;\r\n            if (e.isActive == false)\r\n                continue;\r\n            if (e.enemyType > GameData.ENEMY_CHOPPER)\r\n                continue;\r\n            if (dir > 0) {\r\n                if (e.scene.x > x && e.scene.x - x < 150) {\r\n                    if (Math.abs(y - e.scene.y) < 30)\r\n                        return true;\r\n                }\r\n            }\r\n            else {\r\n                if (e.scene.x < x && x - e.scene.x < 150)\r\n                    if (Math.abs(y - e.scene.y) < 30)\r\n                        return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    get roleInfo() {\r\n        return this.playerInfo;\r\n    }\r\n    set curLevelData(l) {\r\n        this.curLvData = l;\r\n    }\r\n    get curLevelData() {\r\n        return this.curLvData;\r\n    }\r\n    getPlayerBulletDamage(type) {\r\n        if (type == GameData.WEAPON_PIS) {\r\n            return 1;\r\n        }\r\n        else if (type == GameData.WEAPON_RIFLE) {\r\n            return 2;\r\n        }\r\n        else if (type == GameData.WEAPON_MAC) {\r\n            return 2;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    createVideoData(t, info) {\r\n        var v = new VideoData();\r\n        v.type = t;\r\n        v.info = info;\r\n        return v;\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/Data/PlayerData.ts",
    "D:/littleGame/gunfire/src/Data/GameData.ts",
    "D:/littleGame/gunfire/src/Manager/EventManager.ts",
    "D:/littleGame/gunfire/src/Control/GameEvent.ts",
    "D:/littleGame/gunfire/src/Manager/SoundManager.ts",
    "D:/littleGame/gunfire/src/Manager/SaveManager.ts",
    "D:/littleGame/gunfire/src/View/Enemy.ts",
    "D:/littleGame/gunfire/src/Manager/MooSnowSDK.ts",
    "D:/littleGame/gunfire/src/Data/VideoData.ts"
  ]
}
