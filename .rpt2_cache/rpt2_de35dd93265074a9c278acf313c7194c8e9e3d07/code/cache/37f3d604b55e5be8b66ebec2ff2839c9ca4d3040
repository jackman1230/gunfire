{
  "code": "import PlayerAni from \"./PlayerAni\";\r\nimport { ViewManager } from \"../Manager/ViewManager\";\r\nimport { PlayerData, BombData } from \"../Data/PlayerData\";\r\nimport PlayerBody from \"./PlayerBody\";\r\nexport default class Player extends Laya.Script {\r\n    constructor() {\r\n        super();\r\n        this.direction = 0;\r\n        this.sRun = false;\r\n        this.sFire = false;\r\n        this.sBoom = false;\r\n        this.keyRight = false;\r\n        this.keyLeft = false;\r\n        this.keyJump = false;\r\n        this.speed = 5;\r\n        this.jumpHigh = 200;\r\n        this.weaponType = 1;\r\n        this.stillFireNum = 1;\r\n    }\r\n    initView() {\r\n        Laya.Scene.load(\"PlayerBody.scene\", Laya.Handler.create(this, this.loadComplete));\r\n    }\r\n    ;\r\n    loadComplete(s) {\r\n        this.roleBody = s;\r\n        this.rolePlayer = fairygui.UIPackage.createObject(\"Game\", \"Player\");\r\n        this.rolePlayer.setPivot(0.5, 0.5);\r\n        this.body = this.rolePlayer.getChildAt(0);\r\n        this.firePos1 = this.rolePlayer.getChildAt(1);\r\n        this.firePos2 = this.rolePlayer.getChildAt(2);\r\n        this.firePosCtl = this.rolePlayer.getController(\"firePos\");\r\n        this.fireTypeCtl = this.rolePlayer.getController(\"fireType\");\r\n        this.fireTypeCtl.selectedIndex = this.firePosCtl.selectedIndex = 0;\r\n        this.firePos1.visible = this.firePos2.visible = false;\r\n        this.playerAni = new PlayerAni();\r\n        this.playerAni.initView();\r\n        this.roleBody.addChild(this.rolePlayer.displayObject);\r\n        this.roleBody.addComponent(PlayerBody);\r\n        this.setStay();\r\n        this.setRight();\r\n        Laya.stage.on(Laya.Event.KEY_DOWN, this, this.keyDowmEvent);\r\n        Laya.stage.on(Laya.Event.KEY_UP, this, this.keyUpEvent);\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.setFire);\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.setFireEnd);\r\n    }\r\n    keyUpEvent(e) {\r\n        var keyCode = e[\"keyCode\"];\r\n        switch (keyCode) {\r\n            case 65:\r\n                this.keyLeft = false;\r\n                if (this.keyRight == false) {\r\n                    this.sRun = false;\r\n                    if (this.keyJump == false)\r\n                        this.stopMove();\r\n                }\r\n                break;\r\n            case 68:\r\n                this.keyRight = false;\r\n                if (this.keyLeft == false) {\r\n                    this.sRun = false;\r\n                    if (this.keyJump == false)\r\n                        this.stopMove();\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    keyDowmEvent(e) {\r\n        var keyCode = e[\"keyCode\"];\r\n        console.log(keyCode);\r\n        switch (keyCode) {\r\n            case 87:\r\n                console.log(\"上\");\r\n                break;\r\n            case 83:\r\n                console.log(\"下\");\r\n                break;\r\n            case 65:\r\n                this.keyLeft = true;\r\n                console.log(\"左\");\r\n                this.setLeft();\r\n                if (this.sRun)\r\n                    return;\r\n                this.setRun();\r\n                this.stillRun();\r\n                break;\r\n            case 68:\r\n                this.keyRight = true;\r\n                console.log(\"右\");\r\n                this.setRight();\r\n                if (this.sRun)\r\n                    return;\r\n                this.setRun();\r\n                this.stillRun();\r\n                break;\r\n            case 32:\r\n                console.log(\"跳\");\r\n                if (this.keyJump)\r\n                    return;\r\n                this.setJump();\r\n                break;\r\n            case 81:\r\n                console.log(\"扔雷\");\r\n                if (this.sBoom)\r\n                    return;\r\n                this.setBoom();\r\n                break;\r\n            case 69:\r\n                console.log(\"切枪\");\r\n                this.changeWeaponType();\r\n                break;\r\n        }\r\n    }\r\n    setLeft() {\r\n        if (this.direction == -1)\r\n            return;\r\n        this.direction = -1;\r\n        this.rolePlayer.skewY = 0;\r\n    }\r\n    setRight() {\r\n        if (this.direction == 1)\r\n            return;\r\n        this.direction = 1;\r\n        this.rolePlayer.skewY = 180;\r\n    }\r\n    setJump() {\r\n        this.setBoomComplete();\r\n        this.keyJump = true;\r\n        this.bodyLeg.url = \"ui://Game/legJump\";\r\n        Laya.Tween.to(this.roleBody, { y: this.roleBody.y - this.jumpHigh }, 350, null, Laya.Handler.create(this, this.jumpEnd));\r\n    }\r\n    jumpEnd() {\r\n        this.keyJump = false;\r\n        if (this.sBoom) {\r\n            this.setBoomComplete();\r\n        }\r\n        else if (this.sFire) {\r\n            this.body.url = \"ui://Game/player_fire_\" + this.weaponType;\r\n        }\r\n        if (this.sRun) {\r\n            this.bodyLeg.url = \"ui://Game/legMove\";\r\n            this.bodyLeg.content.rewind();\r\n            return;\r\n        }\r\n        this.stopMove();\r\n    }\r\n    setRun() {\r\n        if (this.sRun)\r\n            return;\r\n        if (this.sFire) {\r\n            this.body.url = \"ui://Game/player_fire_\" + this.weaponType;\r\n        }\r\n        else {\r\n            this.body.url = \"ui://Game/player_stay_\" + this.weaponType;\r\n        }\r\n        this.bodyLeg.url = \"ui://Game/legMove\";\r\n        this.sRun = true;\r\n        Laya.timer.clear(this, this.stillRun);\r\n        Laya.timer.frameLoop(1, this, this.stillRun);\r\n    }\r\n    stillRun() {\r\n        if (this.direction == 1) {\r\n            this.roleBody.x += this.speed;\r\n            if (this.roleBody.x - Math.abs(ViewManager.instance.warView.warView.x) >= Laya.Browser.clientWidth / 2) {\r\n                ViewManager.instance.updateViewPort(this.speed);\r\n            }\r\n        }\r\n        else {\r\n            this.roleBody.x -= this.speed;\r\n            if (this.roleBody.x < Math.abs(ViewManager.instance.warView.warView.x))\r\n                this.roleBody.x = Math.abs(ViewManager.instance.warView.warView.x);\r\n        }\r\n        console.log(\"roleplayer--\" + this.rolePlayer.x, this.rolePlayer.y);\r\n    }\r\n    setFire() {\r\n        if (this.sFire)\r\n            return;\r\n        this.sFire = true;\r\n        this.body.url = \"ui://Game/player_fire_\" + this.weaponType;\r\n        this.fireTypeCtl.selectedIndex = this.weaponType - 1;\r\n        this[\"firePos\" + this.weaponType].visible = true;\r\n        Laya.timer.clear(this, this.stillFire);\r\n        Laya.timer.loop(100, this, this.stillFire);\r\n        ViewManager.instance.createBullet();\r\n        if (this.sRun) {\r\n            this.bodyLeg.url = \"ui://Game/legMove\";\r\n            return;\r\n        }\r\n        if (this.keyJump)\r\n            this.bodyLeg.url = \"ui://Game/legJump\";\r\n    }\r\n    stillFire() {\r\n        this.stillFireNum++;\r\n        if (this.stillFireNum % 2 == 0) {\r\n            this[\"firePos\" + this.weaponType].visible = false;\r\n        }\r\n        else {\r\n            this[\"firePos\" + this.weaponType].visible = true;\r\n            ViewManager.instance.createBullet();\r\n        }\r\n    }\r\n    setFireEnd() {\r\n        Laya.timer.clear(this, this.stillFire);\r\n        this.sFire = false;\r\n        this[\"firePos\" + this.weaponType].visible = false;\r\n        this.stillFireNum = 1;\r\n        this.body.url = \"ui://Game/player_stay_\" + this.weaponType;\r\n        if (this.sRun) {\r\n            this.bodyLeg.url = \"ui://Game/legMove\";\r\n            this.bodyLeg.content.setPlaySettings(0, -1, 0, 0);\r\n            return;\r\n        }\r\n        if (this.keyJump)\r\n            this.bodyLeg.url = \"ui://Game/legJump\";\r\n    }\r\n    setBoom() {\r\n        this.sBoom = true;\r\n        this.body.url = \"ui://Game/player_boom_\" + this.weaponType;\r\n        this.bodybody.content.setPlaySettings(0, -1, 1, 0, Laya.Handler.create(this, this.setBoomComplete));\r\n        ViewManager.instance.createBomb(BombData.BOMB_1, this.direction, this.roleBody, true);\r\n        if (this.sRun) {\r\n            this.bodyLeg.url = \"ui://Game/legMove\";\r\n            this.bodyLeg.content.setPlaySettings(0, -1, 0, 0);\r\n            return;\r\n        }\r\n        if (this.keyJump)\r\n            this.bodyLeg.url = \"ui://Game/legJump\";\r\n    }\r\n    setBoomComplete() {\r\n        this.sBoom = false;\r\n        if (this.keyJump)\r\n            return;\r\n        this.bodyLeg.content.rewind();\r\n        if (this.sFire)\r\n            this.body.url = \"ui://Game/player_fire_\" + this.weaponType;\r\n        else\r\n            this.body.url = \"ui://Game/player_stay_\" + this.weaponType;\r\n        if (this.sRun) {\r\n            this.bodyLeg.url = \"ui://Game/legMove\";\r\n            return;\r\n        }\r\n        if (this.keyJump)\r\n            this.bodyLeg.url = \"ui://Game/legJump\";\r\n    }\r\n    stopMove() {\r\n        this.keyLeft = false;\r\n        this.keyRight = false;\r\n        this.sRun = false;\r\n        this.keyJump = false;\r\n        this.bodyLeg.url = \"ui://Game/legStay\";\r\n        Laya.timer.clear(this, this.stillRun);\r\n    }\r\n    setStay() {\r\n        this.body.url = \"ui://Game/player_stay_\" + this.weaponType;\r\n        this.stopMove();\r\n        Laya.timer.clear(this, this.stillFire);\r\n    }\r\n    changeWeaponType() {\r\n        if (this.sBoom)\r\n            return;\r\n        this.weaponType++;\r\n        if (this.weaponType > PlayerData.WEAPON_MAX) {\r\n            this.weaponType = PlayerData.WEAPON_PIS;\r\n        }\r\n        this.body.url = \"ui://Game/player_stay_\" + this.weaponType;\r\n        if (this.sRun)\r\n            this.bodyLeg.url = \"ui://Game/legMove\";\r\n        if (this.keyJump)\r\n            this.bodyLeg.url = \"ui://Game/legJump\";\r\n    }\r\n    beHit() {\r\n        Laya.timer.clear(this, this.setColor);\r\n        this.body.color = \"#ff0000\";\r\n        Laya.timer.once(200, this, this.setColor);\r\n        console.log(\"player--be--hit\");\r\n    }\r\n    setColor() {\r\n        this.body.color = \"#ffffff\";\r\n    }\r\n    get bodyComponent() {\r\n        return this.body.component;\r\n    }\r\n    get bodyLeg() {\r\n        return this.bodyComponent.getChildAt(0).asLoader;\r\n    }\r\n    get bodybody() {\r\n        return this.bodyComponent.getChildAt(1).asLoader;\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_Player.ts",
    "D:/littleGame/gunfire/src/View/PlayerAni.ts",
    "D:/littleGame/gunfire/src/Manager/ViewManager.ts",
    "D:/littleGame/gunfire/src/Data/PlayerData.ts",
    "D:/littleGame/gunfire/src/View/PlayerBody.ts"
  ]
}
