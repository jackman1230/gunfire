"use strict";var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault"),_Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:!0}),exports.logger=logger;var _path=_interopRequireDefault(require("path")),_internalIp=_interopRequireDefault(require("internal-ip")),_ipaddr=_interopRequireDefault(require("ipaddr.js")),_cliSharedUtils=require("@vivo-minigame/cli-shared-utils");// ipv6地址转ipv4
function ipConvert(a){if(_ipaddr.default.IPv6.isValid(a)){var b=_ipaddr.default.IPv6.parse(a);if(b.isIPv4MappedAddress())return b.toIPv4Address().toString()}return a}/**
 * 记录最新的用户进入的请求
 */async function logger(a,b){try{const c=ipConvert(a.request.ip),d=_internalIp.default.v4.sync();0>a.href.indexOf("inspector")&&(0,_cliSharedUtils.info)(`### App Server ### 记录从${c}进入的HTTP请求`),c!==d&&_cliSharedUtils.fs.outputJsonSync(_path.default.resolve(__dirname,"client.json"),{client:c,timestamp:new Date}),await b()}catch(a){(0,_cliSharedUtils.error)(`### App Server ### 记录log出错: ${a.message}`)}}