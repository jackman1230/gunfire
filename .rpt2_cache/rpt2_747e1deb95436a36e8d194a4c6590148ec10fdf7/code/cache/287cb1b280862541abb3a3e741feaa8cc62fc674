{
  "code": "import { WarView } from \"../View/WarView\";\r\nimport Player from \"../View/Player\";\r\nimport Enemy from \"../View/Enemy\";\r\nimport Bullet from \"../View/Bullet\";\r\nexport class ViewManager {\r\n    constructor() {\r\n        this.bulletArr = [];\r\n        this.enemyArr = [];\r\n        this.isChecking = false;\r\n    }\r\n    static get instance() {\r\n        if (this._instance == null)\r\n            this._instance = new ViewManager();\r\n        return this._instance;\r\n    }\r\n    showStartView() {\r\n        this.initView();\r\n        Laya.stage.addChild(this.warView.warView.displayObject);\r\n        this.warView.warView.addChild(this.player.rolePlayer);\r\n        this.player.rolePlayer.x = 200;\r\n        this.player.rolePlayer.y = 400;\r\n        console.log(\"开始初始化界面\");\r\n        this.warView.warView.addChild(this.enemy.enemy);\r\n        this.enemy.enemy.x = 800;\r\n        this.enemy.enemy.y = 400;\r\n        this.enemy.setFire();\r\n        this.enemyArr.push(this.enemy);\r\n    }\r\n    createBullet() {\r\n        var b = new Bullet();\r\n        b.initView();\r\n        b.setBulletData(this.rolePlayer.weaponType, this.rolePlayer.direction);\r\n        var p = this.rolePlayer.rolePlayer.localToGlobal(this.rolePlayer[\"firePos\" + this.rolePlayer.weaponType].x, this.rolePlayer[\"firePos\" + this.rolePlayer.weaponType].y);\r\n        var y = this.bulletRandomY();\r\n        if (this.rolePlayer.direction == 1) {\r\n            b.view.x = Math.abs(this.warView.warView.x) + p.x + b.view.width - 20;\r\n            b.view.y = p.y - this.bulletRandomY();\r\n        }\r\n        else {\r\n            b.view.x = Math.abs(this.warView.warView.x) + p.x - b.view.width * 2 + 20;\r\n            b.view.y = p.y - this.bulletRandomY();\r\n        }\r\n        this.warView.warView.addChild(b.view);\r\n        this.bulletArr.push(b);\r\n        this.addFrameTimer();\r\n        return b;\r\n    }\r\n    addFrameTimer() {\r\n        if (this.isChecking)\r\n            return;\r\n        this.isChecking = true;\r\n        Laya.timer.frameLoop(3, this, this.updateBulletPos);\r\n    }\r\n    checkBulletHit() {\r\n        if (this.isChecking)\r\n            return;\r\n    }\r\n    initView() {\r\n        this.warView = new WarView();\r\n        this.player = new Player();\r\n        this.enemy = new Enemy();\r\n        this.warView.initView();\r\n        this.player.initView();\r\n        this.enemy.initView();\r\n    }\r\n    get rolePlayer() {\r\n        return this.player;\r\n    }\r\n    updateBulletPos() {\r\n        for (let i = this.bulletArr.length - 1; i >= 0; i--) {\r\n            var b = this.bulletArr[i];\r\n            if (b.isEnd) {\r\n                b.view.dispose();\r\n                this.bulletArr.splice(i, 1);\r\n                b = null;\r\n                continue;\r\n            }\r\n            b.updateView();\r\n            for (let j = 0; j < this.enemyArr.length; j++) {\r\n                var e = this.enemyArr[j];\r\n                if (b.view.x >= e.enemy.x && b.view.x < e.enemy.x + e.enemy.width && b.view.y >= e.enemy.y && b.view.y <= e.enemy.y + e.enemy.height) {\r\n                    e.beHit();\r\n                    b.view.dispose();\r\n                    this.bulletArr.splice(i, 1);\r\n                    b = null;\r\n                }\r\n            }\r\n        }\r\n        if (this.bulletArr.length < 1 || this.enemyArr.length < 1) {\r\n            Laya.timer.clear(this, this.updateBulletPos);\r\n            this.isChecking = false;\r\n            console.log(\"clearFrameLoop\");\r\n        }\r\n    }\r\n    updateViewPort(moveX) {\r\n        this.warView.updateViewPort(moveX);\r\n    }\r\n    bulletRandomY() {\r\n        return Math.floor(Math.random() * 10) + 10;\r\n    }\r\n}\r\n",
  "references": [
    "D:/littleGame/gunfire/src/View/BackGroundView.ts",
    "D:/littleGame/gunfire/src/View/WarView.ts",
    "D:/littleGame/gunfire/src/fui/Game/WXFUI_Player.ts",
    "D:/littleGame/gunfire/src/View/Player.ts",
    "D:/littleGame/gunfire/src/View/Enemy.ts",
    "D:/littleGame/gunfire/src/View/Bullet.ts"
  ]
}
